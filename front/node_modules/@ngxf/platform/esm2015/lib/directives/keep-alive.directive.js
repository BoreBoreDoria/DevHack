/**
 * @fileoverview added by tsickle
 * Generated from: lib/directives/keep-alive.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Injectable, TemplateRef, ViewContainerRef } from '@angular/core';
import * as i0 from "@angular/core";
/** @enum {number} */
const KeepAliveFlags = {
    Detached: 0,
    Attached: 1,
};
export { KeepAliveFlags };
export class ViewRefAttachable {
    /**
     * @param {?} viewRef
     */
    constructor(viewRef) {
        this.flag = 0 /* Detached */;
        this.viewRef = viewRef;
    }
    /**
     * @return {?}
     */
    get attached() {
        return this.flag === 1 /* Attached */;
    }
    /**
     * @return {?}
     */
    get detached() {
        return this.flag === 0 /* Detached */;
    }
    /**
     * @param {?} viewContainer
     * @return {?}
     */
    attachToViewContainerRef(viewContainer) {
        if (this.viewContainerRef || this.attached) {
            throw new TypeError(`You can't use *keepAlive with *ngFor:
  <ng-container *ngFor="...">
    <!-- Wrong! -->
    <ng-container *keepAlive></ng-container>
  </ng-container>

viewRef already attached to viewContainerRef`);
        }
        this.flag = 1 /* Attached */;
        (this.viewContainerRef = viewContainer).insert(this.viewRef);
    }
    /**
     * @return {?}
     */
    detachFromViewContainerRef() {
        if (!this.viewContainerRef || this.detached) {
            throw new TypeError('viewRef already detached from viewContainerRef');
        }
        this.flag = 0 /* Detached */;
        this.viewContainerRef.detach(this.viewContainerRef.indexOf(this.viewRef));
        delete this.viewContainerRef;
    }
    /**
     * @return {?}
     */
    destroy() {
        this.viewRef.destroy();
    }
}
if (false) {
    /** @type {?} */
    ViewRefAttachable.prototype.viewRef;
    /** @type {?} */
    ViewRefAttachable.prototype.flag;
    /** @type {?} */
    ViewRefAttachable.prototype.viewContainerRef;
}
export class KeepAliveConfig {
    constructor() {
        this.limit = 50;
    }
}
KeepAliveConfig.decorators = [
    { type: Injectable, args: [{ providedIn: 'root' },] }
];
/** @nocollapse */ KeepAliveConfig.ɵprov = i0.ɵɵdefineInjectable({ factory: function KeepAliveConfig_Factory() { return new KeepAliveConfig(); }, token: KeepAliveConfig, providedIn: "root" });
if (false) {
    /** @type {?} */
    KeepAliveConfig.prototype.limit;
}
export class KeepAliveGC {
    /**
     * @param {?} config
     */
    constructor(config) {
        this.config = config;
    }
    /**
     * @param {?} viewRefs
     * @return {?}
     */
    collect(viewRefs) {
        /** @type {?} */
        const limit = this.config.limit > 0 ? this.config.limit : Number.MAX_SAFE_INTEGER;
        for (const [templateDef, viewRefAttachable] of Array.from(viewRefs.entries())) {
            if (viewRefs.size <= limit) {
                break;
            }
            if (viewRefAttachable.flag === 0 /* Detached */) {
                viewRefAttachable.destroy();
                viewRefs.delete(templateDef);
                console.log('Collect', viewRefAttachable);
            }
        }
    }
}
KeepAliveGC.decorators = [
    { type: Injectable, args: [{ providedIn: 'root', },] }
];
/** @nocollapse */
KeepAliveGC.ctorParameters = () => [
    { type: KeepAliveConfig }
];
/** @nocollapse */ KeepAliveGC.ɵprov = i0.ɵɵdefineInjectable({ factory: function KeepAliveGC_Factory() { return new KeepAliveGC(i0.ɵɵinject(KeepAliveConfig)); }, token: KeepAliveGC, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    KeepAliveGC.prototype.config;
}
export class KeepAliveViewRefs {
    /**
     * @param {?} gc
     */
    constructor(gc) {
        this.gc = gc;
        this.viewRefs = new Map();
    }
    /**
     * @param {?} templateRef
     * @param {?} viewRef
     * @return {?}
     */
    add(templateRef, viewRef) {
        /** @type {?} */
        const templateDef = this.getTemplateDef(templateRef);
        if (this.viewRefs.has(templateDef)) {
            throw new TypeError('templateRef already exists in viewRefs');
        }
        /** @type {?} */
        const viewRefAttachable = new ViewRefAttachable(viewRef);
        this.viewRefs.set(templateDef, viewRefAttachable);
    }
    /**
     * @param {?} templateRef
     * @return {?}
     */
    has(templateRef) {
        /** @type {?} */
        const templateDef = this.getTemplateDef(templateRef);
        return this.viewRefs.has(templateDef);
    }
    /**
     * @param {?} templateRef
     * @return {?}
     */
    get(templateRef) {
        /** @type {?} */
        const templateDef = this.getTemplateDef(templateRef);
        if (!this.viewRefs.has(templateDef)) {
            throw new TypeError('templateRef not exists in viewRefs');
        }
        return this.viewRefs.get(templateDef);
    }
    /**
     * @param {?} templateRef
     * @return {?}
     */
    delete(templateRef) {
        /** @type {?} */
        const templateDef = this.getTemplateDef(templateRef);
        if (!this.viewRefs.has(templateDef)) {
            throw new TypeError('templateRef not exists in viewRefs');
        }
        this.viewRefs.get(templateRef).viewRef.destroy();
        return this.viewRefs.delete(templateDef);
    }
    /**
     * @param {?} templateRef
     * @return {?}
     */
    reattach(templateRef) {
        /** @type {?} */
        const templateDef = this.getTemplateDef(templateRef);
        /** @type {?} */
        const viewRefAttachable = this.get(templateRef);
        this.viewRefs.set(templateDef, viewRefAttachable);
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.viewRefs.forEach((/**
         * @param {?} viewRefAttachable
         * @return {?}
         */
        (viewRefAttachable) => viewRefAttachable.viewRef.destroy()));
        this.viewRefs.clear();
    }
    /**
     * @return {?}
     */
    collect() {
        this.gc.collect(this.viewRefs);
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    forEach(fn) {
        this.viewRefs.forEach(fn);
    }
    /**
     * @private
     * @param {?} templateRef
     * @return {?}
     */
    getTemplateDef(templateRef) {
        return templateRef['_def'];
    }
}
KeepAliveViewRefs.decorators = [
    { type: Injectable, args: [{ providedIn: 'root' },] }
];
/** @nocollapse */
KeepAliveViewRefs.ctorParameters = () => [
    { type: KeepAliveGC }
];
/** @nocollapse */ KeepAliveViewRefs.ɵprov = i0.ɵɵdefineInjectable({ factory: function KeepAliveViewRefs_Factory() { return new KeepAliveViewRefs(i0.ɵɵinject(KeepAliveGC)); }, token: KeepAliveViewRefs, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    KeepAliveViewRefs.prototype.viewRefs;
    /**
     * @type {?}
     * @private
     */
    KeepAliveViewRefs.prototype.gc;
}
export class KeepAliveManager {
    /**
     * @param {?} viewRefs
     */
    constructor(viewRefs) {
        this.viewRefs = viewRefs;
    }
    /**
     * @param {?} viewContainerRef
     * @param {?} templateRef
     * @return {?}
     */
    attach(viewContainerRef, templateRef) {
        if (!this.viewRefs.has(templateRef)) {
            /** @type {?} */
            const viewRef = templateRef.createEmbeddedView({});
            this.viewRefs.add(templateRef, viewRef);
        }
        else {
            this.viewRefs.reattach(templateRef);
        }
        this.patchClear(viewContainerRef);
        /** @type {?} */
        const viewRefAttachable = this.viewRefs.get(templateRef);
        viewRefAttachable.attachToViewContainerRef(viewContainerRef);
        this.viewRefs.collect();
    }
    /**
     * @param {?} viewContainerRef
     * @param {?} templateRef
     * @return {?}
     */
    detach(viewContainerRef, templateRef) {
        /** @type {?} */
        const viewRefAttachable = this.viewRefs.get(templateRef);
        viewRefAttachable.detachFromViewContainerRef();
        this.viewRefs.collect();
    }
    /**
     * @private
     * @param {?} viewContainerRef
     * @return {?}
     */
    patchClear(viewContainerRef) {
        if (!viewContainerRef[KeepAliveManager.patched]) {
            /** @type {?} */
            const clear = Object.getPrototypeOf(viewContainerRef).clear;
            /** @type {?} */
            const viewRefs = this.viewRefs;
            Object.getPrototypeOf(viewContainerRef).clear = (/**
             * @this {?}
             * @return {?}
             */
            function () {
                viewRefs.forEach((/**
                 * @param {?} v
                 * @return {?}
                 */
                v => { v.viewRef['_view'].state |= (1 << 7); }));
                clear.call(this);
                viewRefs.forEach((/**
                 * @param {?} v
                 * @return {?}
                 */
                v => { v.viewRef['_view'].state &= ~(1 << 7); }));
            });
            Object.defineProperty(viewContainerRef, KeepAliveManager.patched, { get: (/**
                 * @return {?}
                 */
                () => true) });
        }
    }
}
KeepAliveManager.patched = Symbol('Already Patched ViewContainerRef Token');
KeepAliveManager.decorators = [
    { type: Injectable, args: [{ providedIn: 'root' },] }
];
/** @nocollapse */
KeepAliveManager.ctorParameters = () => [
    { type: KeepAliveViewRefs }
];
/** @nocollapse */ KeepAliveManager.ɵprov = i0.ɵɵdefineInjectable({ factory: function KeepAliveManager_Factory() { return new KeepAliveManager(i0.ɵɵinject(KeepAliveViewRefs)); }, token: KeepAliveManager, providedIn: "root" });
if (false) {
    /** @type {?} */
    KeepAliveManager.patched;
    /**
     * @type {?}
     * @private
     */
    KeepAliveManager.prototype.viewRefs;
}
export class KeepAliveDirective {
    /**
     * @param {?} manager
     * @param {?} viewContainerRef
     * @param {?} templateRef
     */
    constructor(manager, viewContainerRef, templateRef) {
        this.manager = manager;
        this.viewContainerRef = viewContainerRef;
        this.templateRef = templateRef;
        manager.attach(viewContainerRef, templateRef);
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.manager.detach(this.viewContainerRef, this.templateRef);
    }
}
KeepAliveDirective.decorators = [
    { type: Directive, args: [{
                selector: '[keepAlive]'
            },] }
];
/** @nocollapse */
KeepAliveDirective.ctorParameters = () => [
    { type: KeepAliveManager },
    { type: ViewContainerRef },
    { type: TemplateRef }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    KeepAliveDirective.prototype.manager;
    /**
     * @type {?}
     * @private
     */
    KeepAliveDirective.prototype.viewContainerRef;
    /**
     * @type {?}
     * @private
     */
    KeepAliveDirective.prototype.templateRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2VlcC1hbGl2ZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Abmd4Zi9wbGF0Zm9ybS8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL2tlZXAtYWxpdmUuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQWEsV0FBVyxFQUFFLGdCQUFnQixFQUFXLE1BQU0sZUFBZSxDQUFDOzs7QUFJekcsTUFBa0IsY0FBYztJQUM5QixRQUFRLEdBQUE7SUFDUixRQUFRLEdBQUE7RUFDVDs7QUFFRCxNQUFNLE9BQU8saUJBQWlCOzs7O0lBZ0I1QixZQUFZLE9BQWdCO1FBWjVCLFNBQUksb0JBQTJDO1FBYTdDLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0lBQ3pCLENBQUM7Ozs7SUFWRCxJQUFJLFFBQVE7UUFDVixPQUFPLElBQUksQ0FBQyxJQUFJLHFCQUE0QixDQUFDO0lBQy9DLENBQUM7Ozs7SUFFRCxJQUFJLFFBQVE7UUFDVixPQUFPLElBQUksQ0FBQyxJQUFJLHFCQUE0QixDQUFDO0lBQy9DLENBQUM7Ozs7O0lBTUQsd0JBQXdCLENBQUMsYUFBK0I7UUFDdEQsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUMxQyxNQUFNLElBQUksU0FBUyxDQUFDOzs7Ozs7NkNBTW1CLENBQUMsQ0FBQztTQUMxQztRQUVELElBQUksQ0FBQyxJQUFJLG1CQUEwQixDQUFDO1FBQ3BDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLGFBQWEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDL0QsQ0FBQzs7OztJQUVELDBCQUEwQjtRQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDM0MsTUFBTSxJQUFJLFNBQVMsQ0FBQyxnREFBZ0QsQ0FB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QWtFOzs7OztJQUV0RCxvQ0FBbUM7O0FBMkNqRCxNQUFNLE9BQU8sa0JBQWtCOzs7Ozs7SUFDN0IsWUFDVSxPQUF5QixFQUN6QixnQkFBa0MsRUFDbEMsV0FBNkI7UUFGN0IsWUFBTyxHQUFQLE9BQU8sQ0FBa0I7UUFDekIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNsQyxnQkFBVyxHQUFYLFdBQVcsQ0FBa0I7UUFFckMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUNoRCxDQUFDOzs7O0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDL0QsQ0FBQzs7O1lBZEYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxhQUFhO2FBQ3hCOzs7O1lBR29CLGdCQUFnQjtZQXJNbUIsZ0JBQWdCO1lBQTdCLFdBQVc7Ozs7Ozs7SUFxTWxELHFDQUFpQzs7Ozs7SUFDakMsOENBQTBDOzs7OztJQUMxQyx5Q0FBcUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIEluamVjdGFibGUsIE9uRGVzdHJveSwgVGVtcGxhdGVSZWYsIFZpZXdDb250YWluZXJSZWYsIFZpZXdSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuZXhwb3J0IHR5cGUgVGVtcGxhdGVEZWYgPSBhbnk7XG5cbmV4cG9ydCBjb25zdCBlbnVtIEtlZXBBbGl2ZUZsYWdzIHtcbiAgRGV0YWNoZWQsXG4gIEF0dGFjaGVkXG59XG5cbmV4cG9ydCBjbGFzcyBWaWV3UmVmQXR0YWNoYWJsZSB7XG5cbiAgdmlld1JlZjogVmlld1JlZjtcblxuICBmbGFnOiBLZWVwQWxpdmVGbGFncyA9IEtlZXBBbGl2ZUZsYWdzLkRldGFjaGVkO1xuXG4gIHZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWY7XG5cbiAgZ2V0IGF0dGFjaGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmZsYWcgPT09IEtlZXBBbGl2ZUZsYWdzLkF0dGFjaGVkO1xuICB9XG5cbiAgZ2V0IGRldGFjaGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmZsYWcgPT09IEtlZXBBbGl2ZUZsYWdzLkRldGFjaGVkO1xuICB9XG5cbiAgY29uc3RydWN0b3Iodmlld1JlZjogVmlld1JlZikge1xuICAgIHRoaXMudmlld1JlZiA9IHZpZXdSZWY7XG4gIH1cblxuICBhdHRhY2hUb1ZpZXdDb250YWluZXJSZWYodmlld0NvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZik6IHZvaWQge1xuICAgIGlmICh0aGlzLnZpZXdDb250YWluZXJSZWYgfHwgdGhpcy5hdHRhY2hlZCkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgWW91IGNhbid0IHVzZSAqa2VlcEFsaXZlIHdpdGggKm5nRm9yOlxuICA8bmctY29udGFpbmVyICpuZ0Zvcj1cIi4uLlwiPlxuICAgIDwhLS0gV3JvbmchIC0tPlxuICAgIDxuZy1jb250YWluZXIgKmtlZXBBbGl2ZT48L25nLWNvbnRhaW5lcj5cbiAgPC9uZy1jb250YWluZXI+XG5cbnZpZXdSZWYgYWxyZWFkeSBhdHRhY2hlZCB0byB2aWV3Q29udGFpbmVyUmVmYCk7XG4gICAgfVxuXG4gICAgdGhpcy5mbGFnID0gS2VlcEFsaXZlRmxhZ3MuQXR0YWNoZWQ7XG4gICAgKHRoaXMudmlld0NvbnRhaW5lclJlZiA9IHZpZXdDb250YWluZXIpLmluc2VydCh0aGlzLnZpZXdSZWYpO1xuICB9XG5cbiAgZGV0YWNoRnJvbVZpZXdDb250YWluZXJSZWYoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnZpZXdDb250YWluZXJSZWYgfHwgdGhpcy5kZXRhY2hlZCkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigndmlld1JlZiBhbHJlYWR5IGRldGFjaGVkIGZyb20gdmlld0NvbnRhaW5lclJlZicpO1xuICAgIH1cblxuICAgIHRoaXMuZmxhZyA9IEtlZXBBbGl2ZUZsYWdzLkRldGFjaGVkO1xuICAgIHRoaXMudmlld0NvbnRhaW5lclJlZi5kZXRhY2godGhpcy52aWV3Q29udGFpbmVyUmVmLmluZGV4T2YodGhpcy52aWV3UmVmKSk7XG4gICAgZGVsZXRlIHRoaXMudmlld0NvbnRhaW5lclJlZjtcbiAgfVxuXG4gIGRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy52aWV3UmVmLmRlc3Ryb3koKTtcbiAgfVxufVxuXG5ASW5qZWN0YWJsZSh7IHByb3ZpZGVkSW46ICdyb290JyB9KVxuZXhwb3J0IGNsYXNzIEtlZXBBbGl2ZUNvbmZpZyB7XG4gIGxpbWl0OiBudW1iZXIgPSA1MDtcbn1cblxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcsICB9KVxuZXhwb3J0IGNsYXNzIEtlZXBBbGl2ZUdDIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjb25maWc6IEtlZXBBbGl2ZUNvbmZpZykge31cblxuICBjb2xsZWN0KHZpZXdSZWZzOiBNYXA8VGVtcGxhdGVEZWYsIFZpZXdSZWZBdHRhY2hhYmxlPik6IHZvaWQge1xuICAgIGNvbnN0IGxpbWl0ID0gdGhpcy5jb25maWcubGltaXQgPiAwID8gdGhpcy5jb25maWcubGltaXQgOiBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUjtcbiAgICBmb3IgKGNvbnN0IFt0ZW1wbGF0ZURlZiwgdmlld1JlZkF0dGFjaGFibGVdIG9mIEFycmF5LmZyb20odmlld1JlZnMuZW50cmllcygpKSkge1xuICAgICAgaWYgKHZpZXdSZWZzLnNpemUgPD0gbGltaXQpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIGlmICh2aWV3UmVmQXR0YWNoYWJsZS5mbGFnID09PSBLZWVwQWxpdmVGbGFncy5EZXRhY2hlZCkge1xuICAgICAgICB2aWV3UmVmQXR0YWNoYWJsZS5kZXN0cm95KCk7XG4gICAgICAgIHZpZXdSZWZzLmRlbGV0ZSh0ZW1wbGF0ZURlZik7XG4gICAgICAgIGNvbnNvbGUubG9nKCdDb2xsZWN0Jywgdmlld1JlZkF0dGFjaGFibGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5ASW5qZWN0YWJsZSh7IHByb3ZpZGVkSW46ICdyb290JyB9KVxuZXhwb3J0IGNsYXNzIEtlZXBBbGl2ZVZpZXdSZWZzIGltcGxlbWVudHMgT25EZXN0cm95IHtcblxuICBwcml2YXRlIHZpZXdSZWZzOiBNYXA8VGVtcGxhdGVEZWYsIFZpZXdSZWZBdHRhY2hhYmxlPiA9IG5ldyBNYXA8VGVtcGxhdGVEZWYsIFZpZXdSZWZBdHRhY2hhYmxlPigpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZ2M6IEtlZXBBbGl2ZUdDKSB7fVxuXG4gIGFkZCh0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55Piwgdmlld1JlZjogVmlld1JlZik6IHZvaWQge1xuICAgIGNvbnN0IHRlbXBsYXRlRGVmID0gdGhpcy5nZXRUZW1wbGF0ZURlZih0ZW1wbGF0ZVJlZik7XG4gICAgaWYgKHRoaXMudmlld1JlZnMuaGFzKHRlbXBsYXRlRGVmKSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigndGVtcGxhdGVSZWYgYWxyZWFkeSBleGlzdHMgaW4gdmlld1JlZnMnKTtcbiAgICB9XG5cbiAgICBjb25zdCB2aWV3UmVmQXR0YWNoYWJsZSA9IG5ldyBWaWV3UmVmQXR0YWNoYWJsZSh2aWV3UmVmKTtcbiAgICB0aGlzLnZpZXdSZWZzLnNldCh0ZW1wbGF0ZURlZiwgdmlld1JlZkF0dGFjaGFibGUpO1xuICB9XG5cbiAgaGFzKHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjxhbnk+KTogYm9vbGVhbiB7XG4gICAgY29uc3QgdGVtcGxhdGVEZWYgPSB0aGlzLmdldFRlbXBsYXRlRGVmKHRlbXBsYXRlUmVmKTtcbiAgICByZXR1cm4gdGhpcy52aWV3UmVmcy5oYXModGVtcGxhdGVEZWYpO1xuICB9XG5cbiAgZ2V0KHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjxhbnk+KTogVmlld1JlZkF0dGFjaGFibGUge1xuICAgIGNvbnN0IHRlbXBsYXRlRGVmID0gdGhpcy5nZXRUZW1wbGF0ZURlZih0ZW1wbGF0ZVJlZik7XG4gICAgaWYgKCF0aGlzLnZpZXdSZWZzLmhhcyh0ZW1wbGF0ZURlZikpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ3RlbXBsYXRlUmVmIG5vdCBleGlzdHMgaW4gdmlld1JlZnMnKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMudmlld1JlZnMuZ2V0KHRlbXBsYXRlRGVmKTtcbiAgfVxuXG4gIGRlbGV0ZSh0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55Pik6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHRlbXBsYXRlRGVmID0gdGhpcy5nZXRUZW1wbGF0ZURlZih0ZW1wbGF0ZVJlZik7XG4gICAgaWYgKCF0aGlzLnZpZXdSZWZzLmhhcyh0ZW1wbGF0ZURlZikpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ3RlbXBsYXRlUmVmIG5vdCBleGlzdHMgaW4gdmlld1JlZnMnKTtcbiAgICB9XG4gICAgdGhpcy52aWV3UmVmcy5nZXQodGVtcGxhdGVSZWYpLnZpZXdSZWYuZGVzdHJveSgpO1xuICAgIHJldHVybiB0aGlzLnZpZXdSZWZzLmRlbGV0ZSh0ZW1wbGF0ZURlZik7XG4gIH1cblxuICByZWF0dGFjaCh0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55Pik6IHZvaWQge1xuICAgIGNvbnN0IHRlbXBsYXRlRGVmID0gdGhpcy5nZXRUZW1wbGF0ZURlZih0ZW1wbGF0ZVJlZik7XG4gICAgY29uc3Qgdmlld1JlZkF0dGFjaGFibGUgPSB0aGlzLmdldCh0ZW1wbGF0ZVJlZik7XG4gICAgdGhpcy52aWV3UmVmcy5zZXQodGVtcGxhdGVEZWYsIHZpZXdSZWZBdHRhY2hhYmxlKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMudmlld1JlZnMuZm9yRWFjaCgodmlld1JlZkF0dGFjaGFibGUpID0+XG4gICAgICB2aWV3UmVmQXR0YWNoYWJsZS52aWV3UmVmLmRlc3Ryb3koKSk7XG4gICAgdGhpcy52aWV3UmVmcy5jbGVhcigpO1xuICB9XG5cbiAgY29sbGVjdCgpOiB2b2lkIHtcbiAgICB0aGlzLmdjLmNvbGxlY3QodGhpcy52aWV3UmVmcyk7XG4gIH1cblxuICBmb3JFYWNoKGZuOiAodjogVmlld1JlZkF0dGFjaGFibGUpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0aGlzLnZpZXdSZWZzLmZvckVhY2goZm4pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUZW1wbGF0ZURlZih0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55Pik6IFRlbXBsYXRlRGVmIHtcbiAgICByZXR1cm4gdGVtcGxhdGVSZWZbJ19kZWYnXTtcbiAgfVxufVxuXG5ASW5qZWN0YWJsZSh7IHByb3ZpZGVkSW46ICdyb290JyB9KVxuZXhwb3J0IGNsYXNzIEtlZXBBbGl2ZU1hbmFnZXIge1xuICBzdGF0aWMgcGF0Y2hlZCA9IFN5bWJvbCgnQWxyZWFkeSBQYXRjaGVkIFZpZXdDb250YWluZXJSZWYgVG9rZW4nKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHZpZXdSZWZzOiBLZWVwQWxpdmVWaWV3UmVmcykge31cblxuICBhdHRhY2godmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZiwgdGVtcGxhdGVSZWY6IFRlbXBsYXRlUmVmPGFueT4pOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMudmlld1JlZnMuaGFzKHRlbXBsYXRlUmVmKSkge1xuICAgICAgY29uc3Qgdmlld1JlZiA9IHRlbXBsYXRlUmVmLmNyZWF0ZUVtYmVkZGVkVmlldyh7fSk7XG4gICAgICB0aGlzLnZpZXdSZWZzLmFkZCh0ZW1wbGF0ZVJlZiwgdmlld1JlZik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudmlld1JlZnMucmVhdHRhY2godGVtcGxhdGVSZWYpO1xuICAgIH1cblxuICAgIHRoaXMucGF0Y2hDbGVhcih2aWV3Q29udGFpbmVyUmVmKTtcblxuICAgIGNvbnN0IHZpZXdSZWZBdHRhY2hhYmxlID0gdGhpcy52aWV3UmVmcy5nZXQodGVtcGxhdGVSZWYpO1xuICAgIHZpZXdSZWZBdHRhY2hhYmxlLmF0dGFjaFRvVmlld0NvbnRhaW5lclJlZih2aWV3Q29udGFpbmVyUmVmKTtcblxuICAgIHRoaXMudmlld1JlZnMuY29sbGVjdCgpO1xuICB9XG5cbiAgZGV0YWNoKHZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYsIHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjxhbnk+KTogdm9pZCB7XG4gICAgY29uc3Qgdmlld1JlZkF0dGFjaGFibGUgPSB0aGlzLnZpZXdSZWZzLmdldCh0ZW1wbGF0ZVJlZik7XG4gICAgdmlld1JlZkF0dGFjaGFibGUuZGV0YWNoRnJvbVZpZXdDb250YWluZXJSZWYoKTtcblxuICAgIHRoaXMudmlld1JlZnMuY29sbGVjdCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBwYXRjaENsZWFyKHZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYpOiB2b2lkIHtcbiAgICBpZiAoIXZpZXdDb250YWluZXJSZWZbS2VlcEFsaXZlTWFuYWdlci5wYXRjaGVkXSkge1xuICAgICAgY29uc3QgY2xlYXIgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yodmlld0NvbnRhaW5lclJlZikuY2xlYXI7XG4gICAgICBjb25zdCB2aWV3UmVmcyA9IHRoaXMudmlld1JlZnM7XG4gICAgICBPYmplY3QuZ2V0UHJvdG90eXBlT2Yodmlld0NvbnRhaW5lclJlZikuY2xlYXIgPSBmdW5jdGlvbiAodGhpczogVmlld0NvbnRhaW5lclJlZikge1xuICAgICAgICB2aWV3UmVmcy5mb3JFYWNoKHYgPT4geyB2LnZpZXdSZWZbICdfdmlldycgXS5zdGF0ZSB8PSAoMSA8PCA3KTsgfSk7XG4gICAgICAgIGNsZWFyLmNhbGwodGhpcyk7XG4gICAgICAgIHZpZXdSZWZzLmZvckVhY2godiA9PiB7IHYudmlld1JlZlsgJ192aWV3JyBdLnN0YXRlICY9IH4oMSA8PCA3KTsgfSk7XG4gICAgICB9O1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHZpZXdDb250YWluZXJSZWYsIEtlZXBBbGl2ZU1hbmFnZXIucGF0Y2hlZCwgeyBnZXQ6ICgpID0+IHRydWUgfSk7XG4gICAgfVxuICB9XG5cbn1cblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2tlZXBBbGl2ZV0nXG59KVxuZXhwb3J0IGNsYXNzIEtlZXBBbGl2ZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbWFuYWdlcjogS2VlcEFsaXZlTWFuYWdlcixcbiAgICBwcml2YXRlIHZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYsXG4gICAgcHJpdmF0ZSB0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55PlxuICApIHtcbiAgICBtYW5hZ2VyLmF0dGFjaCh2aWV3Q29udGFpbmVyUmVmLCB0ZW1wbGF0ZVJlZik7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLm1hbmFnZXIuZGV0YWNoKHRoaXMudmlld0NvbnRhaW5lclJlZiwgdGhpcy50ZW1wbGF0ZVJlZik7XG4gIH1cbn1cbiJdfQ==