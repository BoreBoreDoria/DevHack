/**
 * @fileoverview added by tsickle
 * Generated from: lib/directives/cookies.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Input, TemplateRef, ViewContainerRef } from '@angular/core';
import { CookiesService } from '../tools/cookies.tools';
/** @enum {string} */
const CookiesStrategies = {
    GET: "get",
    SET: "set",
    REMOVE: "remove",
};
/**
 * @record
 */
function CookiesContext() { }
if (false) {
    /** @type {?} */
    CookiesContext.prototype.$implicit;
    /** @type {?} */
    CookiesContext.prototype.data;
}
/**
 * @record
 */
function CookiesStrategy() { }
if (false) {
    /** @type {?} */
    CookiesStrategy.prototype.type;
    /** @type {?} */
    CookiesStrategy.prototype.changes;
    /** @type {?} */
    CookiesStrategy.prototype.require;
}
/** @type {?} */
const COOKIES_CONFIG = [
    {
        type: CookiesStrategies.GET,
        changes: ['cookiesGet'],
        require: ['cookiesGet']
    },
    {
        type: CookiesStrategies.SET,
        changes: [
            'cookiesSet',
            'cookiesValue',
            'cookiesPath',
            'cookiesDomain',
            'cookiesExpires',
            'cookiesSecure'
        ],
        require: ['cookiesSet']
    },
    {
        type: CookiesStrategies.REMOVE,
        changes: ['cookiesRemove', 'cookiesPath', 'cookiesDomain'],
        require: ['cookiesRemove']
    }
];
export class CookiesDirective {
    /**
     * @param {?} templateRef
     * @param {?} viewContainerRef
     * @param {?} cookiesService
     */
    constructor(templateRef, viewContainerRef, cookiesService) {
        this.templateRef = templateRef;
        this.viewContainerRef = viewContainerRef;
        this.cookiesService = cookiesService;
        this.context = {
            $implicit: null,
            /**
             * @return {?}
             */
            get data() { return this.$implicit; }
        };
        this.viewRef = this.viewContainerRef.createEmbeddedView(this.templateRef, this.context);
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        /** @type {?} */
        const strategy = this.findStrategy(changes);
        if (strategy) {
            this.execute(strategy);
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.viewContainerRef.clear();
        if (this.viewRef) {
            this.viewRef.destroy();
            this.viewRef = null;
        }
    }
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    findStrategy(changes) {
        return COOKIES_CONFIG.find((/**
         * @param {?} strategy
         * @return {?}
         */
        (strategy) => {
            return strategy.changes.some((/**
             * @param {?} field
             * @return {?}
             */
            field => !!changes[field]))
                && strategy.require.every((/**
                 * @param {?} field
                 * @return {?}
                 */
                field => !!this[field]));
        }));
    }
    /**
     * @private
     * @param {?} strategy
     * @return {?}
     */
    execute(strategy) {
        /** @type {?} */
        const options = strategy.changes.map((/**
         * @param {?} field
         * @return {?}
         */
        field => this[field]));
        this.action(strategy.type, ...options);
    }
    /**
     * @private
     * @param {?} type
     * @param {...?} options
     * @return {?}
     */
    action(type, ...options) {
        /** @type {?} */
        const name = options[0];
        /** @type {?} */
        const value = options[1];
        /** @type {?} */
        const cookieOptions = {
            path: options[2],
            domain: options[3],
            expires: options[4],
            secure: !!options[5]
        };
        if (CookiesStrategies.GET === type) {
            this.context.$implicit = this.getCookie(name);
        }
        if (CookiesStrategies.SET === type) {
            this.setCookie(name, value, cookieOptions);
            this.context.$implicit = value;
        }
        if (CookiesStrategies.REMOVE === type) {
            this.removeCookie(name, cookieOptions);
            this.context.$implicit = null;
        }
        this.viewRef.markForCheck();
    }
    /**
     * @private
     * @param {?} name
     * @return {?}
     */
    getCookie(name) {
        return this.cookiesService.get(name);
    }
    /**
     * @private
     * @param {?} name
     * @param {?} value
     * @param {?=} options
     * @return {?}
     */
    setCookie(name, value, options) {
        this.cookiesService.set(name, value, options);
    }
    /**
     * @private
     * @param {?} name
     * @param {?=} options
     * @return {?}
     */
    removeCookie(name, options) {
        this.cookiesService.remove(name, options);
    }
}
CookiesDirective.decorators = [
    { type: Directive, args: [{ selector: '[cookies]' },] }
];
/** @nocollapse */
CookiesDirective.ctorParameters = () => [
    { type: TemplateRef },
    { type: ViewContainerRef },
    { type: CookiesService }
];
CookiesDirective.propDecorators = {
    cookiesGet: [{ type: Input }],
    cookiesSet: [{ type: Input }],
    cookiesRemove: [{ type: Input }],
    cookiesValue: [{ type: Input }],
    cookiesPath: [{ type: Input }],
    cookiesDomain: [{ type: Input }],
    cookiesExpires: [{ type: Input }],
    cookiesSecure: [{ type: Input }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    CookiesDirective.prototype.cookiesGet;
    /**
     * @type {?}
     * @private
     */
    CookiesDirective.prototype.cookiesSet;
    /**
     * @type {?}
     * @private
     */
    CookiesDirective.prototype.cookiesRemove;
    /**
     * @type {?}
     * @private
     */
    CookiesDirective.prototype.cookiesValue;
    /**
     * @type {?}
     * @private
     */
    CookiesDirective.prototype.cookiesPath;
    /**
     * @type {?}
     * @private
     */
    CookiesDirective.prototype.cookiesDomain;
    /**
     * @type {?}
     * @private
     */
    CookiesDirective.prototype.cookiesExpires;
    /**
     * @type {?}
     * @private
     */
    CookiesDirective.prototype.cookiesSecure;
    /**
     * @type {?}
     * @private
     */
    CookiesDirective.prototype.context;
    /**
     * @type {?}
     * @private
     */
    CookiesDirective.prototype.viewRef;
    /**
     * @type {?}
     * @private
     */
    CookiesDirective.prototype.templateRef;
    /**
     * @type {?}
     * @private
     */
    CookiesDirective.prototype.viewContainerRef;
    /**
     * @type {?}
     * @private
     */
    CookiesDirective.prototype.cookiesService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29va2llcy5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Abmd4Zi9wbGF0Zm9ybS8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL2Nvb2tpZXMuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBbUIsS0FBSyxFQUF1QyxXQUFXLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdEksT0FBTyxFQUFxQixjQUFjLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQzs7QUFFM0UsTUFBSyxpQkFBaUI7SUFDcEIsR0FBRyxPQUFRO0lBQ1gsR0FBRyxPQUFRO0lBQ1gsTUFBTSxVQUFXO0VBQ2xCOzs7O0FBRUQsNkJBR0M7OztJQUZDLG1DQUFlOztJQUNmLDhCQUFVOzs7OztBQUdaLDhCQUlDOzs7SUFIQywrQkFBd0I7O0lBQ3hCLGtDQUFrQjs7SUFDbEIsa0NBQWtCOzs7TUFHZCxjQUFjLEdBQXNCO0lBQ3hDO1FBQ0UsSUFBSSxFQUFFLGlCQUFpQixDQUFDLEdBQUc7UUFDM0IsT0FBTyxFQUFFLENBQUUsWUFBWSxDQUFFO1FBQ3pCLE9BQU8sRUFBRSxDQUFFLFlBQVksQ0FBRTtLQUMxQjtJQUNEO1FBQ0UsSUFBSSxFQUFFLGlCQUFpQixDQUFDLEdBQUc7UUFDM0IsT0FBTyxFQUFFO1lBQ1AsWUFBWTtZQUNaLGNBQWM7WUFDZCxhQUFhO1lBQ2IsZUFBZTtZQUNmLGdCQUFnQjtZQUNoQixlQUFlO1NBQ2hCO1FBQ0QsT0FBTyxFQUFFLENBQUUsWUFBWSxDQUFFO0tBQzFCO0lBQ0Q7UUFDRSxJQUFJLEVBQUUsaUJBQWlCLENBQUMsTUFBTTtRQUM5QixPQUFPLEVBQUUsQ0FBRSxlQUFlLEVBQUUsYUFBYSxFQUFFLGVBQWUsQ0FBRTtRQUM1RCxPQUFPLEVBQUUsQ0FBRSxlQUFlLENBQUU7S0FDN0I7Q0FDRjtBQUdELE1BQU0sT0FBTyxnQkFBZ0I7Ozs7OztJQW9CM0IsWUFDVSxXQUF3QyxF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ZXdSZWYsIElucHV0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgU2ltcGxlQ2hhbmdlcywgVGVtcGxhdGVSZWYsIFZpZXdDb250YWluZXJSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvb2tpZU9wdGlvbnNBcmdzLCBDb29raWVzU2VydmljZSB9IGZyb20gJy4uL3Rvb2xzL2Nvb2tpZXMudG9vbHMnO1xuXG5lbnVtIENvb2tpZXNTdHJhdGVnaWVzIHtcbiAgR0VUID0gJ2dldCcsXG4gIFNFVCA9ICdzZXQnLFxuICBSRU1PVkUgPSAncmVtb3ZlJ1xufVxuXG5pbnRlcmZhY2UgQ29va2llc0NvbnRleHQge1xuICAkaW1wbGljaXQ6IGFueTtcbiAgZGF0YTogYW55O1xufVxuXG5pbnRlcmZhY2UgQ29va2llc1N0cmF0ZWd5IHtcbiAgdHlwZTogQ29va2llc1N0cmF0ZWdpZXM7XG4gIGNoYW5nZXM6IHN0cmluZ1tdO1xuICByZXF1aXJlOiBzdHJpbmdbXTtcbn1cblxuY29uc3QgQ09PS0lFU19DT05GSUc6IENvb2tpZXNTdHJhdGVneVtdID0gW1xuICB7XG4gICAgdHlwZTogQ29va2llc1N0cmF0ZWdpZXMuR0VULFxuICAgIGNoYW5nZXM6IFsgJ2Nvb2tpZXNHZXQnIF0sXG4gICAgcmVxdWlyZTogWyAnY29va2llc0dldCcgXVxuICB9LFxuICB7XG4gICAgdHlwZTogQ29va2llc1N0cmF0ZWdpZXMuU0VULFxuICAgIGNoYW5nZXM6IFtcbiAgICAgICdjb29raWVzU2V0JyxcbiAgICAgICdjb29raWVzVmFsdWUnLFxuICAgICAgJ2Nvb2tpZXNQYXRoJyxcbiAgICAgICdjb29raWVzRG9tYWluJyxcbiAgICAgICdjb29raWVzRXhwaXJlcycsXG4gICAgICAnY29va2llc1NlY3VyZSdcbiAgICBdLFxuICAgIHJlcXVpcmU6IFsgJ2Nvb2tpZXNTZXQnIF1cbiAgfSxcbiAge1xuICAgIHR5cGU6IENvb2tpZXNTdHJhdGVnaWVzLlJFTU9WRSxcbiAgICBjaGFuZ2VzOiBbICdjb29raWVzUmVtb3ZlJywgJ2Nvb2tpZXNQYXRoJywgJ2Nvb2tpZXNEb21haW4nIF0sXG4gICAgcmVxdWlyZTogWyAnY29va2llc1JlbW92ZScgXVxuICB9XG5dO1xuXG5ARGlyZWN0aXZlKHsgc2VsZWN0b3I6ICdbY29va2llc10nIH0pXG5leHBvcnQgY2xhc3MgQ29va2llc0RpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcblxuICBASW5wdXQoKSBwcml2YXRlIGNvb2tpZXNHZXQ6IHN0cmluZztcbiAgQElucHV0KCkgcHJpdmF0ZSBjb29raWVzU2V0OiBzdHJpbmc7XG4gIEBJbnB1dCgpIHByaXZhdGUgY29va2llc1JlbW92ZTogc3RyaW5nO1xuICBASW5wdXQoKSBwcml2YXRlIGNvb2tpZXNWYWx1ZTogYW55O1xuXG4gIEBJbnB1dCgpIHByaXZhdGUgY29va2llc1BhdGg6IHN0cmluZztcbiAgQElucHV0KCkgcHJpdmF0ZSBjb29raWVzRG9tYWluOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHByaXZhdGUgY29va2llc0V4cGlyZXM6IHN0cmluZyB8IERhdGU7XG4gIEBJbnB1dCgpIHByaXZhdGUgY29va2llc1NlY3VyZTogYm9vbGVhbjtcblxuICBwcml2YXRlIGNvbnRleHQ6IENvb2tpZXNDb250ZXh0ID0ge1xuICAgICRpbXBsaWNpdDogbnVsbCxcbiAgICBnZXQgZGF0YSgpIHsgcmV0dXJuIHRoaXMuJGltcGxpY2l0OyB9XG4gIH07XG5cbiAgcHJpdmF0ZSB2aWV3UmVmOiBFbWJlZGRlZFZpZXdSZWY8Q29va2llc0NvbnRleHQ+ID1cbiAgICB0aGlzLnZpZXdDb250YWluZXJSZWYuY3JlYXRlRW1iZWRkZWRWaWV3KHRoaXMudGVtcGxhdGVSZWYsIHRoaXMuY29udGV4dCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8Q29va2llc0NvbnRleHQ+LFxuICAgIHByaXZhdGUgdmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZixcbiAgICBwcml2YXRlIGNvb2tpZXNTZXJ2aWNlOiBDb29raWVzU2VydmljZVxuICApIHt9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGNvbnN0IHN0cmF0ZWd5OiBDb29raWVzU3RyYXRlZ3kgPSB0aGlzLmZpbmRTdHJhdGVneShjaGFuZ2VzKTtcbiAgICBpZiAoc3RyYXRlZ3kpIHtcbiAgICAgIHRoaXMuZXhlY3V0ZShzdHJhdGVneSk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy52aWV3Q29udGFpbmVyUmVmLmNsZWFyKCk7XG4gICAgaWYgKHRoaXMudmlld1JlZikge1xuICAgICAgdGhpcy52aWV3UmVmLmRlc3Ryb3koKTtcbiAgICAgIHRoaXMudmlld1JlZiA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBmaW5kU3RyYXRlZ3koY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IENvb2tpZXNTdHJhdGVneSB7XG4gICAgcmV0dXJuIENPT0tJRVNfQ09ORklHLmZpbmQoKHN0cmF0ZWd5KSA9PiB7XG4gICAgICByZXR1cm4gc3RyYXRlZ3kuY2hhbmdlcy5zb21lKGZpZWxkID0+ICEhY2hhbmdlc1sgZmllbGQgXSlcbiAgICAgICAgJiYgc3RyYXRlZ3kucmVxdWlyZS5ldmVyeShmaWVsZCA9PiAhIXRoaXNbIGZpZWxkIF0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBleGVjdXRlKHN0cmF0ZWd5OiBDb29raWVzU3RyYXRlZ3kpOiB2b2lkIHtcbiAgICBjb25zdCBvcHRpb25zID0gc3RyYXRlZ3kuY2hhbmdlcy5tYXAoZmllbGQgPT4gdGhpc1sgZmllbGQgXSk7XG5cbiAgICB0aGlzLmFjdGlvbihzdHJhdGVneS50eXBlLCAuLi5vcHRpb25zKTtcbiAgfVxuXG4gIHByaXZhdGUgYWN0aW9uKHR5cGU6IHN0cmluZywgLi4ub3B0aW9uczogc3RyaW5nW10pOiB2b2lkIHtcbiAgICBjb25zdCBuYW1lID0gb3B0aW9uc1sgMCBdO1xuICAgIGNvbnN0IHZhbHVlID0gb3B0aW9uc1sgMSBdO1xuICAgIGNvbnN0IGNvb2tpZU9wdGlvbnM6IENvb2tpZU9wdGlvbnNBcmdzID0ge1xuICAgICAgcGF0aDogb3B0aW9uc1sgMiBdLFxuICAgICAgZG9tYWluOiBvcHRpb25zWyAzIF0sXG4gICAgICBleHBpcmVzOiBvcHRpb25zWyA0IF0sXG4gICAgICBzZWN1cmU6ICEhb3B0aW9uc1sgNSBdXG4gICAgfTtcblxuICAgIGlmIChDb29raWVzU3RyYXRlZ2llcy5HRVQgPT09IHR5cGUpIHtcbiAgICAgIHRoaXMuY29udGV4dC4kaW1wbGljaXQgPSB0aGlzLmdldENvb2tpZShuYW1lKTtcbiAgICB9XG5cbiAgICBpZiAoQ29va2llc1N0cmF0ZWdpZXMuU0VUID09PSB0eXBlKSB7XG4gICAgICB0aGlzLnNldENvb2tpZShuYW1lLCB2YWx1ZSwgY29va2llT3B0aW9ucyk7XG4gICAgICB0aGlzLmNvbnRleHQuJGltcGxpY2l0ID0gdmFsdWU7XG4gICAgfVxuXG4gICAgaWYgKENvb2tpZXNTdHJhdGVnaWVzLlJFTU9WRSA9PT0gdHlwZSkge1xuICAgICAgdGhpcy5yZW1vdmVDb29raWUobmFtZSwgY29va2llT3B0aW9ucyk7XG4gICAgICB0aGlzLmNvbnRleHQuJGltcGxpY2l0ID0gbnVsbDtcbiAgICB9XG5cbiAgICB0aGlzLnZpZXdSZWYubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICBwcml2YXRlIGdldENvb2tpZShuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmNvb2tpZXNTZXJ2aWNlLmdldChuYW1lKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0Q29va2llKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZywgb3B0aW9ucz86IENvb2tpZU9wdGlvbnNBcmdzKTogdm9pZCB7XG4gICAgdGhpcy5jb29raWVzU2VydmljZS5zZXQobmFtZSwgdmFsdWUsIG9wdGlvbnMpO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVDb29raWUobmFtZTogc3RyaW5nLCBvcHRpb25zPzogQ29va2llT3B0aW9uc0FyZ3MpOiB2b2lkIHtcbiAgICB0aGlzLmNvb2tpZXNTZXJ2aWNlLnJlbW92ZShuYW1lLCBvcHRpb25zKTtcbiAgfVxufVxuIl19