/**
 * @fileoverview added by tsickle
 * Generated from: lib/directives/http.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { HttpClient } from '@angular/common/http';
import { Directive, Input, TemplateRef, ViewContainerRef } from '@angular/core';
import { of } from 'rxjs';
import { catchError } from 'rxjs/operators';
/** @enum {string} */
const HttpStrategies = {
    DELETE: "delete",
    GET: "get",
    HEAD: "head",
    JSONP: "jsonp",
    OPTIONS: "options",
    PATCH: "patch",
    POST: "post",
    PUT: "put",
};
/**
 * @record
 */
function HttpContext() { }
if (false) {
    /** @type {?} */
    HttpContext.prototype.$implicit;
    /** @type {?} */
    HttpContext.prototype.data;
}
/**
 * @record
 */
function HttpStrategy() { }
if (false) {
    /** @type {?} */
    HttpStrategy.prototype.type;
    /** @type {?} */
    HttpStrategy.prototype.changes;
    /** @type {?} */
    HttpStrategy.prototype.require;
}
/** @type {?} */
const HTTP_CONFIG = [
    {
        type: HttpStrategies.DELETE,
        changes: ['httpDelete', 'httpWith'],
        require: ['httpDelete']
    },
    {
        type: HttpStrategies.GET,
        changes: ['httpGet', 'httpWith'],
        require: ['httpGet']
    },
    {
        type: HttpStrategies.HEAD,
        changes: ['httpHead', 'httpWith'],
        require: ['httpHead']
    },
    {
        type: HttpStrategies.JSONP,
        changes: ['httpJsonp', 'httpCallback'],
        require: ['httpJsonp', 'httpCallback']
    },
    {
        type: HttpStrategies.OPTIONS,
        changes: ['httpOptions', 'httpWith'],
        require: ['httpOptions']
    },
    {
        type: HttpStrategies.PATCH,
        changes: ['httpPatch', 'httpSend', 'httpWith'],
        require: ['httpPatch']
    },
    {
        type: HttpStrategies.POST,
        changes: ['httpPost', 'httpSend', 'httpWith'],
        require: ['httpPost']
    },
    {
        type: HttpStrategies.PUT,
        changes: ['httpPut', 'httpSend', 'httpWith'],
        require: ['httpPut']
    }
];
export class HttpDirective {
    /**
     * @param {?} http
     * @param {?} templateRef
     * @param {?} viewContainerRef
     */
    constructor(http, templateRef, viewContainerRef) {
        this.http = http;
        this.templateRef = templateRef;
        this.viewContainerRef = viewContainerRef;
        this.context = {
            $implicit: null,
            /**
             * @return {?}
             */
            get data() { return this.$implicit; }
        };
        this.viewRef = this.viewContainerRef.createEmbeddedView(this.templateRef, this.context);
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        /** @type {?} */
        const strategy = this.findStrategy(changes);
        if (strategy) {
            this.execute(strategy);
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.dispose();
        this.viewContainerRef.clear();
        if (this.viewRef) {
            this.viewRef.destroy();
            this.viewRef = null;
        }
    }
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    findStrategy(changes) {
        return HTTP_CONFIG.find((/**
         * @param {?} strategy
         * @return {?}
         */
        (strategy) => {
            return strategy.changes.some((/**
             * @param {?} field
             * @return {?}
             */
            field => !!changes[field]))
                && strategy.require.every((/**
                 * @param {?} field
                 * @return {?}
                 */
                field => !!this[field]));
        }));
    }
    /**
     * @private
     * @param {?} strategy
     * @return {?}
     */
    execute(strategy) {
        /** @type {?} */
        const params = strategy.changes.map((/**
         * @param {?} field
         * @return {?}
         */
        field => this[field]));
        this.request(strategy.type, ...params);
    }
    /**
     * @private
     * @param {?} method
     * @param {...?} params
     * @return {?}
     */
    request(method, ...params) {
        this.dispose();
        this.subscription = this.http[method](...params)
            .pipe(catchError((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            console.error(e);
            return of(null);
        })))
            .subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            this.context.$implicit = data;
            this.viewRef.markForCheck();
        }));
    }
    /**
     * @private
     * @return {?}
     */
    dispose() {
        if (this.subscription && !this.subscription.closed) {
            this.subscription.unsubscribe();
            this.subscription = null;
        }
    }
}
HttpDirective.decorators = [
    { type: Directive, args: [{ selector: '[http]' },] }
];
/** @nocollapse */
HttpDirective.ctorParameters = () => [
    { type: HttpClient },
    { type: TemplateRef },
    { type: ViewContainerRef }
];
HttpDirective.propDecorators = {
    httpDelete: [{ type: Input }],
    httpGet: [{ type: Input }],
    httpHead: [{ type: Input }],
    httpJsonp: [{ type: Input }],
    httpOptions: [{ type: Input }],
    httpPatch: [{ type: Input }],
    httpPost: [{ type: Input }],
    httpPut: [{ type: Input }],
    httpSend: [{ type: Input }],
    httpCallback: [{ type: Input }],
    httpWith: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    HttpDirective.prototype.httpDelete;
    /** @type {?} */
    HttpDirective.prototype.httpGet;
    /** @type {?} */
    HttpDirective.prototype.httpHead;
    /** @type {?} */
    HttpDirective.prototype.httpJsonp;
    /** @type {?} */
    HttpDirective.prototype.httpOptions;
    /** @type {?} */
    HttpDirective.prototype.httpPatch;
    /** @type {?} */
    HttpDirective.prototype.httpPost;
    /** @type {?} */
    HttpDirective.prototype.httpPut;
    /** @type {?} */
    HttpDirective.prototype.httpSend;
    /** @type {?} */
    HttpDirective.prototype.httpCallback;
    /** @type {?} */
    HttpDirective.prototype.httpWith;
    /**
     * @type {?}
     * @private
     */
    HttpDirective.prototype.context;
    /**
     * @type {?}
     * @private
     */
    HttpDirective.prototype.viewRef;
    /**
     * @type {?}
     * @private
     */
    HttpDirective.prototype.subscription;
    /**
     * @type {?}
     * @private
     */
    HttpDirective.prototype.http;
    /**
     * @type {?}
     * @private
     */
    HttpDirective.prototype.templateRef;
    /**
     * @type {?}
     * @private
     */
    HttpDirective.prototype.viewContainerRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Abmd4Zi9wbGF0Zm9ybS8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL2h0dHAuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxTQUFTLEVBQW1CLEtBQUssRUFBdUMsV0FBVyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3RJLE9BQU8sRUFBRSxFQUFFLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQ3hDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7QUFFNUMsTUFBSyxjQUFjO0lBQ2pCLE1BQU0sVUFBVztJQUNqQixHQUFHLE9BQVE7SUFDWCxJQUFJLFFBQVM7SUFDYixLQUFLLFNBQVU7SUFDZixPQUFPLFdBQVk7SUFDbkIsS0FBSyxTQUFVO0lBQ2YsSUFBSSxRQUFTO0lBQ2IsR0FBRyxPQUFRO0VBQ1o7Ozs7QUFFRCwwQkFHQzs7O0lBRkMsZ0NBQWU7O0lBQ2YsMkJBQVU7Ozs7O0FBR1osMkJBSUM7OztJQUhDLDRCQUFxQjs7SUFDckIsK0JBQWtCOztJQUNsQiwrQkFBa0I7OztNQUdkLFdBQVcsR0FBbUI7SUFDbEM7UUFDRSxJQUFJLEVBQUUsY0FBYyxDQUFDLE1BQU07UUFDM0IsT0FBTyxFQUFFLENBQUUsWUFBWSxFQUFFLFVBQVUsQ0FBRTtRQUNyQyxPQUFPLEVBQUUsQ0FBRSxZQUFZLENBQUU7S0FDMUI7SUFDRDtRQUNFLElBQUksRUFBRSxjQUFjLENBQUMsR0FBRztRQUN4QixPQUFPLEVBQUUsQ0FBRSxTQUFTLEVBQUUsVUFBVSxDQUFFO1FBQ2xDLE9BQU8sRUFBRSxDQUFFLFNBQVMsQ0FBRTtLQUN2QjtJQUNEO1FBQ0UsSUFBSSxFQUFFLGNBQWMsQ0FBQyxJQUFJO1FBQ3pCLE9BQU8sRUFBRSxDQUFFLFVBQVUs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SzsyQkFDTCxLQUFLO3VCQUNMLEtBQUs7Ozs7SUFYTixtQ0FBNEI7O0lBQzVCLGdDQUF5Qjs7SUFDekIsaUNBQTBCOztJQUMxQixrQ0FBMkI7O0lBQzNCLG9DQUE2Qjs7SUFDN0Isa0NBQTJCOztJQUMzQixpQ0FBMEI7O0lBQzFCLGdDQUF5Qjs7SUFFekIsaUNBQXVCOztJQUN2QixxQ0FBOEI7O0lBQzlCLGlDQUF1Qjs7Ozs7SUFFdkIsZ0NBR0U7Ozs7O0lBRUYsZ0NBQzJFOzs7OztJQUUzRSxxQ0FBbUM7Ozs7O0lBR2pDLDZCQUF3Qjs7Ozs7SUFDeEIsb0NBQTZDOzs7OztJQUM3Qyx5Q0FBMEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgRGlyZWN0aXZlLCBFbWJlZGRlZFZpZXdSZWYsIElucHV0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgU2ltcGxlQ2hhbmdlcywgVGVtcGxhdGVSZWYsIFZpZXdDb250YWluZXJSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IG9mLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmVudW0gSHR0cFN0cmF0ZWdpZXMge1xuICBERUxFVEUgPSAnZGVsZXRlJyxcbiAgR0VUID0gJ2dldCcsXG4gIEhFQUQgPSAnaGVhZCcsXG4gIEpTT05QID0gJ2pzb25wJyxcbiAgT1BUSU9OUyA9ICdvcHRpb25zJyxcbiAgUEFUQ0ggPSAncGF0Y2gnLFxuICBQT1NUID0gJ3Bvc3QnLFxuICBQVVQgPSAncHV0J1xufVxuXG5pbnRlcmZhY2UgSHR0cENvbnRleHQge1xuICAkaW1wbGljaXQ6IGFueTtcbiAgZGF0YTogYW55O1xufVxuXG5pbnRlcmZhY2UgSHR0cFN0cmF0ZWd5IHtcbiAgdHlwZTogSHR0cFN0cmF0ZWdpZXM7XG4gIGNoYW5nZXM6IHN0cmluZ1tdO1xuICByZXF1aXJlOiBzdHJpbmdbXTtcbn1cblxuY29uc3QgSFRUUF9DT05GSUc6IEh0dHBTdHJhdGVneVtdID0gW1xuICB7XG4gICAgdHlwZTogSHR0cFN0cmF0ZWdpZXMuREVMRVRFLFxuICAgIGNoYW5nZXM6IFsgJ2h0dHBEZWxldGUnLCAnaHR0cFdpdGgnIF0sXG4gICAgcmVxdWlyZTogWyAnaHR0cERlbGV0ZScgXVxuICB9LFxuICB7XG4gICAgdHlwZTogSHR0cFN0cmF0ZWdpZXMuR0VULFxuICAgIGNoYW5nZXM6IFsgJ2h0dHBHZXQnLCAnaHR0cFdpdGgnIF0sXG4gICAgcmVxdWlyZTogWyAnaHR0cEdldCcgXVxuICB9LFxuICB7XG4gICAgdHlwZTogSHR0cFN0cmF0ZWdpZXMuSEVBRCxcbiAgICBjaGFuZ2VzOiBbICdodHRwSGVhZCcsICdodHRwV2l0aCcgXSxcbiAgICByZXF1aXJlOiBbICdodHRwSGVhZCcgXVxuICB9LFxuICB7XG4gICAgdHlwZTogSHR0cFN0cmF0ZWdpZXMuSlNPTlAsXG4gICAgY2hhbmdlczogWyAnaHR0cEpzb25wJywgJ2h0dHBDYWxsYmFjaycgXSxcbiAgICByZXF1aXJlOiBbICdodHRwSnNvbnAnLCAnaHR0cENhbGxiYWNrJyBdXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBIdHRwU3RyYXRlZ2llcy5PUFRJT05TLFxuICAgIGNoYW5nZXM6IFsgJ2h0dHBPcHRpb25zJywgJ2h0dHBXaXRoJyBdLFxuICAgIHJlcXVpcmU6IFsgJ2h0dHBPcHRpb25zJyBdXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBIdHRwU3RyYXRlZ2llcy5QQVRDSCxcbiAgICBjaGFuZ2VzOiBbICdodHRwUGF0Y2gnLCAnaHR0cFNlbmQnLCAnaHR0cFdpdGgnIF0sXG4gICAgcmVxdWlyZTogWyAnaHR0cFBhdGNoJyBdXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBIdHRwU3RyYXRlZ2llcy5QT1NULFxuICAgIGNoYW5nZXM6IFsgJ2h0dHBQb3N0JywgJ2h0dHBTZW5kJywgJ2h0dHBXaXRoJyBdLFxuICAgIHJlcXVpcmU6IFsgJ2h0dHBQb3N0JyBdXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBIdHRwU3RyYXRlZ2llcy5QVVQsXG4gICAgY2hhbmdlczogWyAnaHR0cFB1dCcsICdodHRwU2VuZCcsICdodHRwV2l0aCcgXSxcbiAgICByZXF1aXJlOiBbICdodHRwUHV0JyBdXG4gIH1cbl07XG5cbkBEaXJlY3RpdmUoeyBzZWxlY3RvcjogJ1todHRwXScgfSlcbmV4cG9ydCBjbGFzcyBIdHRwRGlyZWN0aXZlIGltcGxlbWVudHMgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuXG4gIEBJbnB1dCgpIGh0dHBEZWxldGU6IHN0cmluZztcbiAgQElucHV0KCkgaHR0cEdldDogc3RyaW5nO1xuICBASW5wdXQoKSBodHRwSGVhZDogc3RyaW5nO1xuICBASW5wdXQoKSBodHRwSnNvbnA6IHN0cmluZztcbiAgQElucHV0KCkgaHR0cE9wdGlvbnM6IHN0cmluZztcbiAgQElucHV0KCkgaHR0cFBhdGNoOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGh0dHBQb3N0OiBzdHJpbmc7XG4gIEBJbnB1dCgpIGh0dHBQdXQ6IHN0cmluZztcblxuICBASW5wdXQoKSBodHRwU2VuZDogYW55O1xuICBASW5wdXQoKSBodHRwQ2FsbGJhY2s6IHN0cmluZztcbiAgQElucHV0KCkgaHR0cFdpdGg6IGFueTtcblxuICBwcml2YXRlIGNvbnRleHQ6IEh0dHBDb250ZXh0ID0ge1xuICAgICRpbXBsaWNpdDogbnVsbCxcbiAgICBnZXQgZGF0YSgpIHsgcmV0dXJuIHRoaXMuJGltcGxpY2l0OyB9XG4gIH07XG5cbiAgcHJpdmF0ZSB2aWV3UmVmOiBFbWJlZGRlZFZpZXdSZWY8SHR0cENvbnRleHQ+ID1cbiAgICB0aGlzLnZpZXdDb250YWluZXJSZWYuY3JlYXRlRW1iZWRkZWRWaWV3KHRoaXMudGVtcGxhdGVSZWYsIHRoaXMuY29udGV4dCk7XG5cbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXG4gICAgcHJpdmF0ZSB0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8SHR0cENvbnRleHQ+LFxuICAgIHByaXZhdGUgdmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZlxuICApIHt9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGNvbnN0IHN0cmF0ZWd5OiBIdHRwU3RyYXRlZ3kgPSB0aGlzLmZpbmRTdHJhdGVneShjaGFuZ2VzKTtcbiAgICBpZiAoc3RyYXRlZ3kpIHtcbiAgICAgIHRoaXMuZXhlY3V0ZShzdHJhdGVneSk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5kaXNwb3NlKCk7XG4gICAgdGhpcy52aWV3Q29udGFpbmVyUmVmLmNsZWFyKCk7XG4gICAgaWYgKHRoaXMudmlld1JlZikge1xuICAgICAgdGhpcy52aWV3UmVmLmRlc3Ryb3koKTtcbiAgICAgIHRoaXMudmlld1JlZiA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBmaW5kU3RyYXRlZ3koY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IEh0dHBTdHJhdGVneSB7XG4gICAgcmV0dXJuIEhUVFBfQ09ORklHLmZpbmQoKHN0cmF0ZWd5KSA9PiB7XG4gICAgICByZXR1cm4gc3RyYXRlZ3kuY2hhbmdlcy5zb21lKGZpZWxkID0+ICEhY2hhbmdlc1sgZmllbGQgXSlcbiAgICAgICAgJiYgc3RyYXRlZ3kucmVxdWlyZS5ldmVyeShmaWVsZCA9PiAhIXRoaXNbIGZpZWxkIF0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBleGVjdXRlKHN0cmF0ZWd5OiBIdHRwU3RyYXRlZ3kpIHtcbiAgICBjb25zdCBwYXJhbXMgPSBzdHJhdGVneS5jaGFuZ2VzLm1hcChmaWVsZCA9PiB0aGlzWyBmaWVsZCBdKTtcblxuICAgIHRoaXMucmVxdWVzdChzdHJhdGVneS50eXBlLCAuLi5wYXJhbXMpO1xuICB9XG5cbiAgcHJpdmF0ZSByZXF1ZXN0KG1ldGhvZCwgLi4ucGFyYW1zKSB7XG4gICAgdGhpcy5kaXNwb3NlKCk7XG4gICAgdGhpcy5zdWJzY3JpcHRpb24gPSB0aGlzLmh0dHBbIG1ldGhvZCBdKC4uLnBhcmFtcylcbiAgICAgIC5waXBlKGNhdGNoRXJyb3IoKGUpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xuICAgICAgfSkpXG4gICAgICAuc3Vic2NyaWJlKChkYXRhKSA9PiB7XG4gICAgICAgIHRoaXMuY29udGV4dC4kaW1wbGljaXQgPSBkYXRhO1xuICAgICAgICB0aGlzLnZpZXdSZWYubWFya0ZvckNoZWNrKCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZGlzcG9zZSgpIHtcbiAgICBpZiAodGhpcy5zdWJzY3JpcHRpb24gJiYgIXRoaXMuc3Vic2NyaXB0aW9uLmNsb3NlZCkge1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gbnVsbDtcbiAgICB9XG4gIH1cbn1cbiJdfQ==