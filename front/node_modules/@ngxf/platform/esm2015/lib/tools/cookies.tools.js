/**
 * @fileoverview added by tsickle
 * Generated from: lib/tools/cookies.tools.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Inject, Injectable, Optional } from '@angular/core';
import { APP_BASE_HREF } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
/**
 * @record
 */
export function CookieOptionsArgs() { }
if (false) {
    /** @type {?|undefined} */
    CookieOptionsArgs.prototype.path;
    /** @type {?|undefined} */
    CookieOptionsArgs.prototype.domain;
    /** @type {?|undefined} */
    CookieOptionsArgs.prototype.expires;
    /** @type {?|undefined} */
    CookieOptionsArgs.prototype.secure;
}
/**
 * @record
 */
export function ICookies() { }
/**
 * @record
 */
export function ICookieService() { }
if (false) {
    /**
     * @param {?} key
     * @return {?}
     */
    ICookieService.prototype.get = function (key) { };
    /**
     * @param {?} key
     * @param {?} value
     * @param {?=} options
     * @return {?}
     */
    ICookieService.prototype.set = function (key, value, options) { };
    /**
     * @param {?} key
     * @param {?=} options
     * @return {?}
     */
    ICookieService.prototype.remove = function (key, options) { };
}
export class CookieOptions {
    /**
     * @param {?=} __0
     */
    constructor({ path, domain, expires, secure } = {}) {
        this.path = this.isPresent(path) ? path : null;
        this.domain = this.isPresent(domain) ? domain : null;
        this.expires = this.isPresent(expires) ? expires : null;
        this.secure = this.isPresent(secure) ? secure : false;
    }
    /**
     * @param {?=} options
     * @return {?}
     */
    merge(options) {
        return new CookieOptions((/** @type {?} */ ({
            path: this.isPresent(options) && this.isPresent(options.path) ? options.path : this.path,
            domain: this.isPresent(options) && this.isPresent(options.domain) ? options.domain : this.domain,
            expires: this.isPresent(options) && this.isPresent(options.expires) ? options.expires : this.expires,
            secure: this.isPresent(options) && this.isPresent(options.secure) ? options.secure : this.secure,
        })));
    }
    /**
     * @private
     * @param {?} obj
     * @return {?}
     */
    isPresent(obj) {
        return obj !== undefined && obj !== null;
    }
}
if (false) {
    /** @type {?} */
    CookieOptions.prototype.path;
    /** @type {?} */
    CookieOptions.prototype.domain;
    /** @type {?} */
    CookieOptions.prototype.expires;
    /** @type {?} */
    CookieOptions.prototype.secure;
}
export class BaseCookieOptions extends CookieOptions {
    /**
     * @param {?} baseHref
     */
    constructor(baseHref) {
        super({ path: baseHref || '/' });
        this.baseHref = baseHref;
    }
}
BaseCookieOptions.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
BaseCookieOptions.ctorParameters = () => [
    { type: String, decorators: [{ type: Optional }, { type: Inject, args: [APP_BASE_HREF,] }] }
];
/** @nocollapse */ BaseCookieOptions.ɵprov = i0.ɵɵdefineInjectable({ factory: function BaseCookieOptions_Factory() { return new BaseCookieOptions(i0.ɵɵinject(i1.APP_BASE_HREF, 8)); }, token: BaseCookieOptions, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    BaseCookieOptions.prototype.baseHref;
}
export class CookiesService {
    /**
     * @param {?=} defaultOptions
     */
    constructor(defaultOptions) {
        this.defaultOptions = defaultOptions;
    }
    /**
     * @protected
     * @return {?}
     */
    get cookieString() {
        return document.cookie || '';
    }
    /**
     * @protected
     * @param {?} val
     * @return {?}
     */
    set cookieString(val) {
        document.cookie = val;
    }
    /**
     * @private
     * @param {?} key
     * @return {?}
     */
    cookieReader(key) {
        /** @type {?} */
        const currentCookieString = this.cookieString;
        if (currentCookieString) {
            /** @type {?} */
            const cookieArray = currentCookieString.split('; ');
            return cookieArray.reduce((/**
             * @param {?} cookies
             * @param {?} current
             * @return {?}
             */
            (cookies, current) => {
                /** @type {?} */
                const cookie = current.split('=');
                return Object.assign(Object.assign({}, cookies), { [cookie[0]]: decodeURIComponent(cookie[1]) });
            }), {})[key];
        }
    }
    /**
     * @private
     * @param {?} name
     * @param {?} value
     * @param {?=} options
     * @return {?}
     */
    cookieWriter(name, value, options) {
        this.cookieString = this.buildCookieString(name, value, options);
    }
    /**
     * @private
     * @param {?} name
     * @param {?} value
     * @param {?=} options
     * @return {?}
     */
    buildCookieString(name, value, options) {
        /** @type {?} */
        const defaultOpts = this.defaultOptions || new CookieOptions((/** @type {?} */ ({ path: '/' })));
        /** @type {?} */
        const opts = this.mergeOptions(defaultOpts, options);
        /** @type {?} */
        let expires = opts.expires;
        if (!value) {
            expires = 'Thu, 01 Jan 1970 00:00:00 GMT';
            value = '';
        }
        if (typeof expires === 'string') {
            expires = new Date(expires);
        }
        /** @type {?} */
        let str = encodeURIComponent(name) + '=' + encodeURIComponent(value);
        str += opts.path ? `;path=${opts.path}` : '';
        str += opts.domain ? `;domain=${opts.domain}` : '';
        str += expires ? `;expires=${expires.toUTCString()}` : '';
        str += opts.secure ? ';secure' : '';
        /** @type {?} */
        const cookieLength = str.length + 1;
        if (cookieLength > 4096) {
            console.log(`Cookie \'${name}\' possibly not set or overflowed because it was too large (${cookieLength} > 4096 bytes)!`);
        }
        return str;
    }
    /**
     * @private
     * @param {?} defaultOpts
     * @param {?=} providedOpts
     * @return {?}
     */
    mergeOptions(defaultOpts, providedOpts) {
        /** @type {?} */
        const newOpts = defaultOpts;
        if (providedOpts) {
            return newOpts.merge(new CookieOptions(providedOpts));
        }
        return newOpts;
    }
    /**
     * @param {?} key
     * @return {?}
     */
    get(key) {
        return this.cookieReader(key);
    }
    /**
     * @param {?} key
     * @param {?} value
     * @param {?=} options
     * @return {?}
     */
    set(key, value, options) {
        this.cookieWriter(key, value, options);
    }
    /**
     * @param {?} key
     * @param {?=} options
     * @return {?}
     */
    remove(key, options) {
        this.cookieWriter(key, undefined, options);
    }
}
CookiesService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
CookiesService.ctorParameters = () => [
    { type: CookieOptions, decorators: [{ type: Optional }] }
];
/** @nocollapse */ CookiesService.ɵprov = i0.ɵɵdefineInjectable({ factory: function CookiesService_Factory() { return new CookiesService(i0.ɵɵinject(CookieOptions, 8)); }, token: CookiesService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    CookiesService.prototype.defaultOptions;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29va2llcy50b29scy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BuZ3hmL3BsYXRmb3JtLyIsInNvdXJjZXMiOlsibGliL3Rvb2xzL2Nvb2tpZXMudG9vbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0QsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDOzs7Ozs7QUFFaEQsdUNBS0M7OztJQUpHLGlDQUFjOztJQUNkLG1DQUFnQjs7SUFDaEIsb0NBQXdCOztJQUN4QixtQ0FBaUI7Ozs7O0FBR3JCLDhCQUVDOzs7O0FBRUQsb0NBSUM7Ozs7OztJQUhHLGtEQUF5Qjs7Ozs7OztJQUN6QixrRUFBbUU7Ozs7OztJQUNuRSw4REFBdUQ7O0FBRzNELE1BQU0sT0FBTyxhQUFhOzs7O0lBT3RCLFlBQVksRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxNQUFNLEtBQXdCLEVBQUU7UUFDakUsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUMvQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQ3JELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDeEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUMxRCxD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LENBQUMsRUFBRSxDQUFDOztjQUU5QixZQUFZLEdBQUcsR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDO1FBRW5DLElBQUksWUFBWSxHQUFHLElBQUksRUFBRTtZQUNyQixPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksSUFBSSwrREFBK0QsWUFBWSxpQkFBaUIsQ0FBQyxDQUFDO1NBQzdIO1FBRUQsT0FBTyxHQUFHLENBQUM7SUFDZixDQUFDOzs7Ozs7O0lBRU8sWUFBWSxDQUFDLFdBQTBCLEVBQUUsWUFBZ0M7O2NBQ3ZFLE9BQU8sR0FBRyxXQUFXO1FBRTNCLElBQUksWUFBWSxFQUFFO1lBQ2QsT0FBTyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7U0FDekQ7UUFFRCxPQUFPLE9BQU8sQ0FBQztJQUNuQixDQUFDOzs7OztJQUVNLEdBQUcsQ0FBQyxHQUFXO1FBQ2xCLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNsQyxDQUFDOzs7Ozs7O0lBRU0sR0FBRyxDQUFDLEdBQVcsRUFBRSxLQUFhLEVBQUUsT0FBMkI7UUFDOUQsSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzNDLENBQUM7Ozs7OztJQUVNLE1BQU0sQ0FBQyxHQUFXLEVBQUUsT0FBMkI7UUFDbEQsSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQy9DLENBQUM7OztZQXZGSixVQUFVLFNBQUM7Z0JBQ1IsVUFBVSxFQUFFLE1BQU07YUFDckI7Ozs7WUFJNEMsYUFBYSx1QkFBakQsUUFBUTs7Ozs7Ozs7SUFBVCx3Q0FBa0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFQUF9CQVNFX0hSRUYgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBDb29raWVPcHRpb25zQXJncyB7XHJcbiAgICBwYXRoPzogc3RyaW5nO1xyXG4gICAgZG9tYWluPzogc3RyaW5nO1xyXG4gICAgZXhwaXJlcz86IHN0cmluZyB8IERhdGU7XHJcbiAgICBzZWN1cmU/OiBib29sZWFuO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElDb29raWVzIHtcclxuICAgIFtrZXk6IHN0cmluZ106IHN0cmluZ1tdO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElDb29raWVTZXJ2aWNlIHtcclxuICAgIGdldChrZXk6IHN0cmluZyk6IHN0cmluZztcclxuICAgIHNldChrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZywgb3B0aW9ucz86IENvb2tpZU9wdGlvbnNBcmdzKTogdm9pZDtcclxuICAgIHJlbW92ZShrZXk6IHN0cmluZywgb3B0aW9ucz86IENvb2tpZU9wdGlvbnNBcmdzKTogdm9pZDtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIENvb2tpZU9wdGlvbnMge1xyXG5cclxuICAgIHB1YmxpYyBwYXRoOiBzdHJpbmc7XHJcbiAgICBwdWJsaWMgZG9tYWluOiBzdHJpbmc7XHJcbiAgICBwdWJsaWMgZXhwaXJlczogc3RyaW5nIHwgRGF0ZTtcclxuICAgIHB1YmxpYyBzZWN1cmU6IGJvb2xlYW47XHJcblxyXG4gICAgY29uc3RydWN0b3IoeyBwYXRoLCBkb21haW4sIGV4cGlyZXMsIHNlY3VyZSB9OiBDb29raWVPcHRpb25zQXJncyA9IHt9KSB7XHJcbiAgICAgICAgdGhpcy5wYXRoID0gdGhpcy5pc1ByZXNlbnQocGF0aCkgPyBwYXRoIDogbnVsbDtcclxuICAgICAgICB0aGlzLmRvbWFpbiA9IHRoaXMuaXNQcmVzZW50KGRvbWFpbikgPyBkb21haW4gOiBudWxsO1xyXG4gICAgICAgIHRoaXMuZXhwaXJlcyA9IHRoaXMuaXNQcmVzZW50KGV4cGlyZXMpID8gZXhwaXJlcyA6IG51bGw7XHJcbiAgICAgICAgdGhpcy5zZWN1cmUgPSB0aGlzLmlzUHJlc2VudChzZWN1cmUpID8gc2VjdXJlIDogZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG1lcmdlKG9wdGlvbnM/OiBDb29raWVPcHRpb25zQXJncyk6IENvb2tpZU9wdGlvbnMge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ29va2llT3B0aW9ucyg8Q29va2llT3B0aW9uc0FyZ3M+e1xyXG4gICAgICAgICAgICBwYXRoOiB0aGlzLmlzUHJlc2VudChvcHRpb25zKSAmJiB0aGlzLmlzUHJlc2VudChvcHRpb25zLnBhdGgpID8gb3B0aW9ucy5wYXRoIDogdGhpcy5wYXRoLFxyXG4gICAgICAgICAgICBkb21haW46IHRoaXMuaXNQcmVzZW50KG9wdGlvbnMpICYmIHRoaXMuaXNQcmVzZW50KG9wdGlvbnMuZG9tYWluKSA/IG9wdGlvbnMuZG9tYWluIDogdGhpcy5kb21haW4sXHJcbiAgICAgICAgICAgIGV4cGlyZXM6IHRoaXMuaXNQcmVzZW50KG9wdGlvbnMpICYmIHRoaXMuaXNQcmVzZW50KG9wdGlvbnMuZXhwaXJlcykgPyBvcHRpb25zLmV4cGlyZXMgOiB0aGlzLmV4cGlyZXMsXHJcbiAgICAgICAgICAgIHNlY3VyZTogdGhpcy5pc1ByZXNlbnQob3B0aW9ucykgJiYgdGhpcy5pc1ByZXNlbnQob3B0aW9ucy5zZWN1cmUpID8gb3B0aW9ucy5zZWN1cmUgOiB0aGlzLnNlY3VyZSxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGlzUHJlc2VudChvYmo6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiBvYmogIT09IHVuZGVmaW5lZCAmJiBvYmogIT09IG51bGw7XHJcbiAgICB9XHJcbn1cclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICAgIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgQmFzZUNvb2tpZU9wdGlvbnMgZXh0ZW5kcyBDb29raWVPcHRpb25zIHtcclxuICAgIGNvbnN0cnVjdG9yKEBPcHRpb25hbCgpIEBJbmplY3QoQVBQX0JBU0VfSFJFRikgcHJpdmF0ZSBiYXNlSHJlZjogc3RyaW5nKSB7XHJcbiAgICAgICAgc3VwZXIoeyBwYXRoOiBiYXNlSHJlZiB8fCAnLycgfSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICAgIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgQ29va2llc1NlcnZpY2UgaW1wbGVtZW50cyBJQ29va2llU2VydmljZSB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBkZWZhdWx0T3B0aW9ucz86IENvb2tpZU9wdGlvbnNcclxuICAgICkge1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBnZXQgY29va2llU3RyaW5nKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNvb2tpZSB8fCAnJztcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgc2V0IGNvb2tpZVN0cmluZyh2YWw6IHN0cmluZykge1xyXG4gICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IHZhbDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNvb2tpZVJlYWRlcihrZXk6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgY3VycmVudENvb2tpZVN0cmluZyA9IHRoaXMuY29va2llU3RyaW5nO1xyXG5cclxuICAgICAgICBpZiAoY3VycmVudENvb2tpZVN0cmluZykge1xyXG4gICAgICAgICAgICBjb25zdCBjb29raWVBcnJheSA9IGN1cnJlbnRDb29raWVTdHJpbmcuc3BsaXQoJzsgJyk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY29va2llQXJyYXkucmVkdWNlKChjb29raWVzOiBJQ29va2llcywgY3VycmVudDogc3RyaW5nKTogb2JqZWN0ID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvb2tpZSA9IGN1cnJlbnQuc3BsaXQoJz0nKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5jb29raWVzLCBbY29va2llWzBdXTogZGVjb2RlVVJJQ29tcG9uZW50KGNvb2tpZVsxXSkgfTtcclxuICAgICAgICAgICAgfSwge30pW2tleV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY29va2llV3JpdGVyKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZywgb3B0aW9ucz86IENvb2tpZU9wdGlvbnNBcmdzKSB7XHJcbiAgICAgICAgdGhpcy5jb29raWVTdHJpbmcgPSB0aGlzLmJ1aWxkQ29va2llU3RyaW5nKG5hbWUsIHZhbHVlLCBvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJ1aWxkQ29va2llU3RyaW5nKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZywgb3B0aW9ucz86IENvb2tpZU9wdGlvbnNBcmdzKTogc3RyaW5nIHtcclxuICAgICAgICBjb25zdCBkZWZhdWx0T3B0cyA9IHRoaXMuZGVmYXVsdE9wdGlvbnMgfHwgbmV3IENvb2tpZU9wdGlvbnMoPENvb2tpZU9wdGlvbnNBcmdzPnsgcGF0aDogJy8nIH0pO1xyXG4gICAgICAgIGNvbnN0IG9wdHM6IENvb2tpZU9wdGlvbnMgPSB0aGlzLm1lcmdlT3B0aW9ucyhkZWZhdWx0T3B0cywgb3B0aW9ucyk7XHJcblxyXG4gICAgICAgIGxldCBleHBpcmVzID0gb3B0cy5leHBpcmVzO1xyXG5cclxuICAgICAgICBpZiAoIXZhbHVlKSB7XHJcbiAgICAgICAgICAgIGV4cGlyZXMgPSAnVGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBHTVQnO1xyXG4gICAgICAgICAgICB2YWx1ZSA9ICcnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBleHBpcmVzID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICBleHBpcmVzID0gbmV3IERhdGUoZXhwaXJlcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgc3RyID0gZW5jb2RlVVJJQ29tcG9uZW50KG5hbWUpICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKTtcclxuXHJcbiAgICAgICAgc3RyICs9IG9wdHMucGF0aCA/IGA7cGF0aD0ke29wdHMucGF0aH1gIDogJyc7XHJcbiAgICAgICAgc3RyICs9IG9wdHMuZG9tYWluID8gYDtkb21haW49JHtvcHRzLmRvbWFpbn1gIDogJyc7XHJcbiAgICAgICAgc3RyICs9IGV4cGlyZXMgPyBgO2V4cGlyZXM9JHtleHBpcmVzLnRvVVRDU3RyaW5nKCl9YCA6ICcnO1xyXG4gICAgICAgIHN0ciArPSBvcHRzLnNlY3VyZSA/ICc7c2VjdXJlJyA6ICcnO1xyXG5cclxuICAgICAgICBjb25zdCBjb29raWVMZW5ndGggPSBzdHIubGVuZ3RoICsgMTtcclxuXHJcbiAgICAgICAgaWYgKGNvb2tpZUxlbmd0aCA+IDQwOTYpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYENvb2tpZSBcXCcke25hbWV9XFwnIHBvc3NpYmx5IG5vdCBzZXQgb3Igb3ZlcmZsb3dlZCBiZWNhdXNlIGl0IHdhcyB0b28gbGFyZ2UgKCR7Y29va2llTGVuZ3RofSA+IDQwOTYgYnl0ZXMpIWApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHN0cjtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1lcmdlT3B0aW9ucyhkZWZhdWx0T3B0czogQ29va2llT3B0aW9ucywgcHJvdmlkZWRPcHRzPzogQ29va2llT3B0aW9uc0FyZ3MpOiBDb29raWVPcHRpb25zIHtcclxuICAgICAgICBjb25zdCBuZXdPcHRzID0gZGVmYXVsdE9wdHM7XHJcblxyXG4gICAgICAgIGlmIChwcm92aWRlZE9wdHMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ld09wdHMubWVyZ2UobmV3IENvb2tpZU9wdGlvbnMocHJvdmlkZWRPcHRzKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbmV3T3B0cztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0KGtleTogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb29raWVSZWFkZXIoa2V5KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0KGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBvcHRpb25zPzogQ29va2llT3B0aW9uc0FyZ3MpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmNvb2tpZVdyaXRlcihrZXksIHZhbHVlLCBvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVtb3ZlKGtleTogc3RyaW5nLCBvcHRpb25zPzogQ29va2llT3B0aW9uc0FyZ3MpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmNvb2tpZVdyaXRlcihrZXksIHVuZGVmaW5lZCwgb3B0aW9ucyk7XHJcbiAgICB9XHJcbn1cclxuIl19