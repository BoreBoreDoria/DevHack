/**
 * @fileoverview added by tsickle
 * Generated from: lib/directives/keep-alive.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { __read, __values } from "tslib";
import { Directive, Injectable, TemplateRef, ViewContainerRef } from '@angular/core';
import * as i0 from "@angular/core";
/** @enum {number} */
var KeepAliveFlags = {
    Detached: 0,
    Attached: 1,
};
export { KeepAliveFlags };
var ViewRefAttachable = /** @class */ (function () {
    function ViewRefAttachable(viewRef) {
        this.flag = 0 /* Detached */;
        this.viewRef = viewRef;
    }
    Object.defineProperty(ViewRefAttachable.prototype, "attached", {
        get: /**
         * @return {?}
         */
        function () {
            return this.flag === 1 /* Attached */;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ViewRefAttachable.prototype, "detached", {
        get: /**
         * @return {?}
         */
        function () {
            return this.flag === 0 /* Detached */;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} viewContainer
     * @return {?}
     */
    ViewRefAttachable.prototype.attachToViewContainerRef = /**
     * @param {?} viewContainer
     * @return {?}
     */
    function (viewContainer) {
        if (this.viewContainerRef || this.attached) {
            throw new TypeError("You can't use *keepAlive with *ngFor:\n  <ng-container *ngFor=\"...\">\n    <!-- Wrong! -->\n    <ng-container *keepAlive></ng-container>\n  </ng-container>\n\nviewRef already attached to viewContainerRef");
        }
        this.flag = 1 /* Attached */;
        (this.viewContainerRef = viewContainer).insert(this.viewRef);
    };
    /**
     * @return {?}
     */
    ViewRefAttachable.prototype.detachFromViewContainerRef = /**
     * @return {?}
     */
    function () {
        if (!this.viewContainerRef || this.detached) {
            throw new TypeError('viewRef already detached from viewContainerRef');
        }
        this.flag = 0 /* Detached */;
        this.viewContainerRef.detach(this.viewContainerRef.indexOf(this.viewRef));
        delete this.viewContainerRef;
    };
    /**
     * @return {?}
     */
    ViewRefAttachable.prototype.destroy = /**
     * @return {?}
     */
    function () {
        this.viewRef.destroy();
    };
    return ViewRefAttachable;
}());
export { ViewRefAttachable };
if (false) {
    /** @type {?} */
    ViewRefAttachable.prototype.viewRef;
    /** @type {?} */
    ViewRefAttachable.prototype.flag;
    /** @type {?} */
    ViewRefAttachable.prototype.viewContainerRef;
}
var KeepAliveConfig = /** @class */ (function () {
    function KeepAliveConfig() {
        this.limit = 50;
    }
    KeepAliveConfig.decorators = [
        { type: Injectable, args: [{ providedIn: 'root' },] }
    ];
    /** @nocollapse */ KeepAliveConfig.ɵprov = i0.ɵɵdefineInjectable({ factory: function KeepAliveConfig_Factory() { return new KeepAliveConfig(); }, token: KeepAliveConfig, providedIn: "root" });
    return KeepAliveConfig;
}());
export { KeepAliveConfig };
if (false) {
    /** @type {?} */
    KeepAliveConfig.prototype.limit;
}
var KeepAliveGC = /** @class */ (function () {
    function KeepAliveGC(config) {
        this.config = config;
    }
    /**
     * @param {?} viewRefs
     * @return {?}
     */
    KeepAliveGC.prototype.collect = /**
     * @param {?} viewRefs
     * @return {?}
     */
    function (viewRefs) {
        var e_1, _a;
        /** @type {?} */
        var limit = this.config.limit > 0 ? this.config.limit : Number.MAX_SAFE_INTEGER;
        try {
            for (var _b = __values(Array.from(viewRefs.entries())), _c = _b.next(); !_c.done; _c = _b.next()) {
                var _d = __read(_c.value, 2), templateDef = _d[0], viewRefAttachable = _d[1];
                if (viewRefs.size <= limit) {
                    break;
                }
                if (viewRefAttachable.flag === 0 /* Detached */) {
                    viewRefAttachable.destroy();
                    viewRefs.delete(templateDef);
                    console.log('Collect', viewRefAttachable);
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    KeepAliveGC.decorators = [
        { type: Injectable, args: [{ providedIn: 'root', },] }
    ];
    /** @nocollapse */
    KeepAliveGC.ctorParameters = function () { return [
        { type: KeepAliveConfig }
    ]; };
    /** @nocollapse */ KeepAliveGC.ɵprov = i0.ɵɵdefineInjectable({ factory: function KeepAliveGC_Factory() { return new KeepAliveGC(i0.ɵɵinject(KeepAliveConfig)); }, token: KeepAliveGC, providedIn: "root" });
    return KeepAliveGC;
}());
export { KeepAliveGC };
if (false) {
    /**
     * @type {?}
     * @private
     */
    KeepAliveGC.prototype.config;
}
var KeepAliveViewRefs = /** @class */ (function () {
    function KeepAliveViewRefs(gc) {
        this.gc = gc;
        this.viewRefs = new Map();
    }
    /**
     * @param {?} templateRef
     * @param {?} viewRef
     * @return {?}
     */
    KeepAliveViewRefs.prototype.add = /**
     * @param {?} templateRef
     * @param {?} viewRef
     * @return {?}
     */
    function (templateRef, viewRef) {
        /** @type {?} */
        var templateDef = this.getTemplateDef(templateRef);
        if (this.viewRefs.has(templateDef)) {
            throw new TypeError('templateRef already exists in viewRefs');
        }
        /** @type {?} */
        var viewRefAttachable = new ViewRefAttachable(viewRef);
        this.viewRefs.set(templateDef, viewRefAttachable);
    };
    /**
     * @param {?} templateRef
     * @return {?}
     */
    KeepAliveViewRefs.prototype.has = /**
     * @param {?} templateRef
     * @return {?}
     */
    function (templateRef) {
        /** @type {?} */
        var templateDef = this.getTemplateDef(templateRef);
        return this.viewRefs.has(templateDef);
    };
    /**
     * @param {?} templateRef
     * @return {?}
     */
    KeepAliveViewRefs.prototype.get = /**
     * @param {?} templateRef
     * @return {?}
     */
    function (templateRef) {
        /** @type {?} */
        var templateDef = this.getTemplateDef(templateRef);
        if (!this.viewRefs.has(templateDef)) {
            throw new TypeError('templateRef not exists in viewRefs');
        }
        return this.viewRefs.get(templateDef);
    };
    /**
     * @param {?} templateRef
     * @return {?}
     */
    KeepAliveViewRefs.prototype.delete = /**
     * @param {?} templateRef
     * @return {?}
     */
    function (templateRef) {
        /** @type {?} */
        var templateDef = this.getTemplateDef(templateRef);
        if (!this.viewRefs.has(templateDef)) {
            throw new TypeError('templateRef not exists in viewRefs');
        }
        this.viewRefs.get(templateRef).viewRef.destroy();
        return this.viewRefs.delete(templateDef);
    };
    /**
     * @param {?} templateRef
     * @return {?}
     */
    KeepAliveViewRefs.prototype.reattach = /**
     * @param {?} templateRef
     * @return {?}
     */
    function (templateRef) {
        /** @type {?} */
        var templateDef = this.getTemplateDef(templateRef);
        /** @type {?} */
        var viewRefAttachable = this.get(templateRef);
        this.viewRefs.set(templateDef, viewRefAttachable);
    };
    /**
     * @return {?}
     */
    KeepAliveViewRefs.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.viewRefs.forEach((/**
         * @param {?} viewRefAttachable
         * @return {?}
         */
        function (viewRefAttachable) {
            return viewRefAttachable.viewRef.destroy();
        }));
        this.viewRefs.clear();
    };
    /**
     * @return {?}
     */
    KeepAliveViewRefs.prototype.collect = /**
     * @return {?}
     */
    function () {
        this.gc.collect(this.viewRefs);
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    KeepAliveViewRefs.prototype.forEach = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.viewRefs.forEach(fn);
    };
    /**
     * @private
     * @param {?} templateRef
     * @return {?}
     */
    KeepAliveViewRefs.prototype.getTemplateDef = /**
     * @private
     * @param {?} templateRef
     * @return {?}
     */
    function (templateRef) {
        return templateRef['_def'];
    };
    KeepAliveViewRefs.decorators = [
        { type: Injectable, args: [{ providedIn: 'root' },] }
    ];
    /** @nocollapse */
    KeepAliveViewRefs.ctorParameters = function () { return [
        { type: KeepAliveGC }
    ]; };
    /** @nocollapse */ KeepAliveViewRefs.ɵprov = i0.ɵɵdefineInjectable({ factory: function KeepAliveViewRefs_Factory() { return new KeepAliveViewRefs(i0.ɵɵinject(KeepAliveGC)); }, token: KeepAliveViewRefs, providedIn: "root" });
    return KeepAliveViewRefs;
}());
export { KeepAliveViewRefs };
if (false) {
    /**
     * @type {?}
     * @private
     */
    KeepAliveViewRefs.prototype.viewRefs;
    /**
     * @type {?}
     * @private
     */
    KeepAliveViewRefs.prototype.gc;
}
var KeepAliveManager = /** @class */ (function () {
    function KeepAliveManager(viewRefs) {
        this.viewRefs = viewRefs;
    }
    /**
     * @param {?} viewContainerRef
     * @param {?} templateRef
     * @return {?}
     */
    KeepAliveManager.prototype.attach = /**
     * @param {?} viewContainerRef
     * @param {?} templateRef
     * @return {?}
     */
    function (viewContainerRef, templateRef) {
        if (!this.viewRefs.has(templateRef)) {
            /** @type {?} */
            var viewRef = templateRef.createEmbeddedView({});
            this.viewRefs.add(templateRef, viewRef);
        }
        else {
            this.viewRefs.reattach(templateRef);
        }
        this.patchClear(viewContainerRef);
        /** @type {?} */
        var viewRefAttachable = this.viewRefs.get(templateRef);
        viewRefAttachable.attachToViewContainerRef(viewContainerRef);
        this.viewRefs.collect();
    };
    /**
     * @param {?} viewContainerRef
     * @param {?} templateRef
     * @return {?}
     */
    KeepAliveManager.prototype.detach = /**
     * @param {?} viewContainerRef
     * @param {?} templateRef
     * @return {?}
     */
    function (viewContainerRef, templateRef) {
        /** @type {?} */
        var viewRefAttachable = this.viewRefs.get(templateRef);
        viewRefAttachable.detachFromViewContainerRef();
        this.viewRefs.collect();
    };
    /**
     * @private
     * @param {?} viewContainerRef
     * @return {?}
     */
    KeepAliveManager.prototype.patchClear = /**
     * @private
     * @param {?} viewContainerRef
     * @return {?}
     */
    function (viewContainerRef) {
        if (!viewContainerRef[KeepAliveManager.patched]) {
            /** @type {?} */
            var clear_1 = Object.getPrototypeOf(viewContainerRef).clear;
            /** @type {?} */
            var viewRefs_1 = this.viewRefs;
            Object.getPrototypeOf(viewContainerRef).clear = (/**
             * @this {?}
             * @return {?}
             */
            function () {
                viewRefs_1.forEach((/**
                 * @param {?} v
                 * @return {?}
                 */
                function (v) { v.viewRef['_view'].state |= (1 << 7); }));
                clear_1.call(this);
                viewRefs_1.forEach((/**
                 * @param {?} v
                 * @return {?}
                 */
                function (v) { v.viewRef['_view'].state &= ~(1 << 7); }));
            });
            Object.defineProperty(viewContainerRef, KeepAliveManager.patched, { get: (/**
                 * @return {?}
                 */
                function () { return true; }) });
        }
    };
    KeepAliveManager.patched = Symbol('Already Patched ViewContainerRef Token');
    KeepAliveManager.decorators = [
        { type: Injectable, args: [{ providedIn: 'root' },] }
    ];
    /** @nocollapse */
    KeepAliveManager.ctorParameters = function () { return [
        { type: KeepAliveViewRefs }
    ]; };
    /** @nocollapse */ KeepAliveManager.ɵprov = i0.ɵɵdefineInjectable({ factory: function KeepAliveManager_Factory() { return new KeepAliveManager(i0.ɵɵinject(KeepAliveViewRefs)); }, token: KeepAliveManager, providedIn: "root" });
    return KeepAliveManager;
}());
export { KeepAliveManager };
if (false) {
    /** @type {?} */
    KeepAliveManager.patched;
    /**
     * @type {?}
     * @private
     */
    KeepAliveManager.prototype.viewRefs;
}
var KeepAliveDirective = /** @class */ (function () {
    function KeepAliveDirective(manager, viewContainerRef, templateRef) {
        this.manager = manager;
        this.viewContainerRef = viewContainerRef;
        this.templateRef = templateRef;
        manager.attach(viewContainerRef, templateRef);
    }
    /**
     * @return {?}
     */
    KeepAliveDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.manager.detach(this.viewContainerRef, this.templateRef);
    };
    KeepAliveDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[keepAlive]'
                },] }
    ];
    /** @nocollapse */
    KeepAliveDirective.ctorParameters = function () { return [
        { type: KeepAliveManager },
        { type: ViewContainerRef },
        { type: TemplateRef }
    ]; };
    return KeepAliveDirective;
}());
export { KeepAliveDirective };
if (false) {
    /**
     * @type {?}
     * @private
     */
    KeepAliveDirective.prototype.manager;
    /**
     * @type {?}
     * @private
     */
    KeepAliveDirective.prototype.viewContainerRef;
    /**
     * @type {?}
     * @private
     */
    KeepAliveDirective.prototype.templateRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2VlcC1hbGl2ZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Abmd4Zi9wbGF0Zm9ybS8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL2tlZXAtYWxpdmUuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFhLFdBQVcsRUFBRSxnQkFBZ0IsRUFBVyxNQUFNLGVBQWUsQ0FBQzs7O0FBSXpHLElBQWtCLGNBQWM7SUFDOUIsUUFBUSxHQUFBO0lBQ1IsUUFBUSxHQUFBO0VBQ1Q7O0FBRUQ7SUFnQkUsMkJBQVksT0FBZ0I7UUFaNUIsU0FBSSxvQkFBMkM7UUFhN0MsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7SUFDekIsQ0FBQztJQVZELHNCQUFJLHVDQUFROzs7O1FBQVo7WUFDRSxPQUFPLElBQUksQ0FBQyxJQUFJLHFCQUE0QixDQUFDO1FBQy9DLENBQUM7OztPQUFBO0lBRUQsc0JBQUksdUNBQVE7Ozs7UUFBWjtZQUNFLE9BQU8sSUFBSSxDQUFDLElBQUkscUJBQTRCLENBQUM7UUFDL0MsQ0FBQzs7O09BQUE7Ozs7O0lBTUQsb0RBQXdCOzs7O0lBQXhCLFVBQXlCLGFBQStCO1FBQ3RELElBQUksSUFBSSxDQUFDLGdCQUFnQixJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDMUMsTUFBTSxJQUFJLFNBQVMsQ0FBQyw4TUFNbUIsQ0FBQyxDQUFDO1NBQzFDO1FBRUQsSUFBSSxDQUFDLElBQUksbUJBQTBCLENBQUM7UUFDcEMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsYUFBYSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUMvRCxDQUFDOzs7O0lBRUQsc0RBQTBCOzs7SUFBMUI7UUFDRSxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDM0MsTUFBTSxJQUFJ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LENBQUMsQ0FBQSxDQUFDO1lBQ0YsTUFBTSxDQUFDLGNBQWMsQ0FBQyxnQkFBZ0IsRUFBRSxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsRUFBRSxHQUFHOzs7Z0JBQUUsY0FBTSxPQUFBLElBQUksRUFBSixDQUFJLENBQUEsRUFBRSxDQUFDLENBQUM7U0FDeEY7SUFDSCxDQUFDO0lBdENNLHdCQUFPLEdBQUcsTUFBTSxDQUFDLHdDQUF3QyxDQUFDLENBQUM7O2dCQUZuRSxVQUFVLFNBQUMsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFOzs7O2dCQUlGLGlCQUFpQjs7OzJCQXhKakQ7Q0E4TEMsQUExQ0QsSUEwQ0M7U0F6Q1ksZ0JBQWdCOzs7SUFDM0IseUJBQWtFOzs7OztJQUV0RCxvQ0FBbUM7O0FBd0NqRDtJQUlFLDRCQUNVLE9BQXlCLEVBQ3pCLGdCQUFrQyxFQUNsQyxXQUE2QjtRQUY3QixZQUFPLEdBQVAsT0FBTyxDQUFrQjtRQUN6QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLGdCQUFXLEdBQVgsV0FBVyxDQUFrQjtRQUVyQyxPQUFPLENBQUMsTUFBTSxDQUFDLGdCQUFnQixFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQ2hELENBQUM7Ozs7SUFFRCx3Q0FBVzs7O0lBQVg7UUFDRSxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQy9ELENBQUM7O2dCQWRGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsYUFBYTtpQkFDeEI7Ozs7Z0JBR29CLGdCQUFnQjtnQkFyTW1CLGdCQUFnQjtnQkFBN0IsV0FBVzs7SUErTXRELHlCQUFDO0NBQUEsQUFmRCxJQWVDO1NBWlksa0JBQWtCOzs7Ozs7SUFFM0IscUNBQWlDOzs7OztJQUNqQyw4Q0FBMEM7Ozs7O0lBQzFDLHlDQUFxQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgSW5qZWN0YWJsZSwgT25EZXN0cm95LCBUZW1wbGF0ZVJlZiwgVmlld0NvbnRhaW5lclJlZiwgVmlld1JlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5leHBvcnQgdHlwZSBUZW1wbGF0ZURlZiA9IGFueTtcblxuZXhwb3J0IGNvbnN0IGVudW0gS2VlcEFsaXZlRmxhZ3Mge1xuICBEZXRhY2hlZCxcbiAgQXR0YWNoZWRcbn1cblxuZXhwb3J0IGNsYXNzIFZpZXdSZWZBdHRhY2hhYmxlIHtcblxuICB2aWV3UmVmOiBWaWV3UmVmO1xuXG4gIGZsYWc6IEtlZXBBbGl2ZUZsYWdzID0gS2VlcEFsaXZlRmxhZ3MuRGV0YWNoZWQ7XG5cbiAgdmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZjtcblxuICBnZXQgYXR0YWNoZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZmxhZyA9PT0gS2VlcEFsaXZlRmxhZ3MuQXR0YWNoZWQ7XG4gIH1cblxuICBnZXQgZGV0YWNoZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZmxhZyA9PT0gS2VlcEFsaXZlRmxhZ3MuRGV0YWNoZWQ7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcih2aWV3UmVmOiBWaWV3UmVmKSB7XG4gICAgdGhpcy52aWV3UmVmID0gdmlld1JlZjtcbiAgfVxuXG4gIGF0dGFjaFRvVmlld0NvbnRhaW5lclJlZih2aWV3Q29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmKTogdm9pZCB7XG4gICAgaWYgKHRoaXMudmlld0NvbnRhaW5lclJlZiB8fCB0aGlzLmF0dGFjaGVkKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBZb3UgY2FuJ3QgdXNlICprZWVwQWxpdmUgd2l0aCAqbmdGb3I6XG4gIDxuZy1jb250YWluZXIgKm5nRm9yPVwiLi4uXCI+XG4gICAgPCEtLSBXcm9uZyEgLS0+XG4gICAgPG5nLWNvbnRhaW5lciAqa2VlcEFsaXZlPjwvbmctY29udGFpbmVyPlxuICA8L25nLWNvbnRhaW5lcj5cblxudmlld1JlZiBhbHJlYWR5IGF0dGFjaGVkIHRvIHZpZXdDb250YWluZXJSZWZgKTtcbiAgICB9XG5cbiAgICB0aGlzLmZsYWcgPSBLZWVwQWxpdmVGbGFncy5BdHRhY2hlZDtcbiAgICAodGhpcy52aWV3Q29udGFpbmVyUmVmID0gdmlld0NvbnRhaW5lcikuaW5zZXJ0KHRoaXMudmlld1JlZik7XG4gIH1cblxuICBkZXRhY2hGcm9tVmlld0NvbnRhaW5lclJlZigpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMudmlld0NvbnRhaW5lclJlZiB8fCB0aGlzLmRldGFjaGVkKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCd2aWV3UmVmIGFscmVhZHkgZGV0YWNoZWQgZnJvbSB2aWV3Q29udGFpbmVyUmVmJyk7XG4gICAgfVxuXG4gICAgdGhpcy5mbGFnID0gS2VlcEFsaXZlRmxhZ3MuRGV0YWNoZWQ7XG4gICAgdGhpcy52aWV3Q29udGFpbmVyUmVmLmRldGFjaCh0aGlzLnZpZXdDb250YWluZXJSZWYuaW5kZXhPZih0aGlzLnZpZXdSZWYpKTtcbiAgICBkZWxldGUgdGhpcy52aWV3Q29udGFpbmVyUmVmO1xuICB9XG5cbiAgZGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLnZpZXdSZWYuZGVzdHJveSgpO1xuICB9XG59XG5cbkBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pXG5leHBvcnQgY2xhc3MgS2VlcEFsaXZlQ29uZmlnIHtcbiAgbGltaXQ6IG51bWJlciA9IDUwO1xufVxuXG5ASW5qZWN0YWJsZSh7IHByb3ZpZGVkSW46ICdyb290JywgIH0pXG5leHBvcnQgY2xhc3MgS2VlcEFsaXZlR0Mge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNvbmZpZzogS2VlcEFsaXZlQ29uZmlnKSB7fVxuXG4gIGNvbGxlY3Qodmlld1JlZnM6IE1hcDxUZW1wbGF0ZURlZiwgVmlld1JlZkF0dGFjaGFibGU+KTogdm9pZCB7XG4gICAgY29uc3QgbGltaXQgPSB0aGlzLmNvbmZpZy5saW1pdCA+IDAgPyB0aGlzLmNvbmZpZy5saW1pdCA6IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSO1xuICAgIGZvciAoY29uc3QgW3RlbXBsYXRlRGVmLCB2aWV3UmVmQXR0YWNoYWJsZV0gb2YgQXJyYXkuZnJvbSh2aWV3UmVmcy5lbnRyaWVzKCkpKSB7XG4gICAgICBpZiAodmlld1JlZnMuc2l6ZSA8PSBsaW1pdCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgaWYgKHZpZXdSZWZBdHRhY2hhYmxlLmZsYWcgPT09IEtlZXBBbGl2ZUZsYWdzLkRldGFjaGVkKSB7XG4gICAgICAgIHZpZXdSZWZBdHRhY2hhYmxlLmRlc3Ryb3koKTtcbiAgICAgICAgdmlld1JlZnMuZGVsZXRlKHRlbXBsYXRlRGVmKTtcbiAgICAgICAgY29uc29sZS5sb2coJ0NvbGxlY3QnLCB2aWV3UmVmQXR0YWNoYWJsZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbkBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pXG5leHBvcnQgY2xhc3MgS2VlcEFsaXZlVmlld1JlZnMgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuXG4gIHByaXZhdGUgdmlld1JlZnM6IE1hcDxUZW1wbGF0ZURlZiwgVmlld1JlZkF0dGFjaGFibGU+ID0gbmV3IE1hcDxUZW1wbGF0ZURlZiwgVmlld1JlZkF0dGFjaGFibGU+KCk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBnYzogS2VlcEFsaXZlR0MpIHt9XG5cbiAgYWRkKHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjxhbnk+LCB2aWV3UmVmOiBWaWV3UmVmKTogdm9pZCB7XG4gICAgY29uc3QgdGVtcGxhdGVEZWYgPSB0aGlzLmdldFRlbXBsYXRlRGVmKHRlbXBsYXRlUmVmKTtcbiAgICBpZiAodGhpcy52aWV3UmVmcy5oYXModGVtcGxhdGVEZWYpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCd0ZW1wbGF0ZVJlZiBhbHJlYWR5IGV4aXN0cyBpbiB2aWV3UmVmcycpO1xuICAgIH1cblxuICAgIGNvbnN0IHZpZXdSZWZBdHRhY2hhYmxlID0gbmV3IFZpZXdSZWZBdHRhY2hhYmxlKHZpZXdSZWYpO1xuICAgIHRoaXMudmlld1JlZnMuc2V0KHRlbXBsYXRlRGVmLCB2aWV3UmVmQXR0YWNoYWJsZSk7XG4gIH1cblxuICBoYXModGVtcGxhdGVSZWY6IFRlbXBsYXRlUmVmPGFueT4pOiBib29sZWFuIHtcbiAgICBjb25zdCB0ZW1wbGF0ZURlZiA9IHRoaXMuZ2V0VGVtcGxhdGVEZWYodGVtcGxhdGVSZWYpO1xuICAgIHJldHVybiB0aGlzLnZpZXdSZWZzLmhhcyh0ZW1wbGF0ZURlZik7XG4gIH1cblxuICBnZXQodGVtcGxhdGVSZWY6IFRlbXBsYXRlUmVmPGFueT4pOiBWaWV3UmVmQXR0YWNoYWJsZSB7XG4gICAgY29uc3QgdGVtcGxhdGVEZWYgPSB0aGlzLmdldFRlbXBsYXRlRGVmKHRlbXBsYXRlUmVmKTtcbiAgICBpZiAoIXRoaXMudmlld1JlZnMuaGFzKHRlbXBsYXRlRGVmKSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigndGVtcGxhdGVSZWYgbm90IGV4aXN0cyBpbiB2aWV3UmVmcycpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy52aWV3UmVmcy5nZXQodGVtcGxhdGVEZWYpO1xuICB9XG5cbiAgZGVsZXRlKHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjxhbnk+KTogYm9vbGVhbiB7XG4gICAgY29uc3QgdGVtcGxhdGVEZWYgPSB0aGlzLmdldFRlbXBsYXRlRGVmKHRlbXBsYXRlUmVmKTtcbiAgICBpZiAoIXRoaXMudmlld1JlZnMuaGFzKHRlbXBsYXRlRGVmKSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigndGVtcGxhdGVSZWYgbm90IGV4aXN0cyBpbiB2aWV3UmVmcycpO1xuICAgIH1cbiAgICB0aGlzLnZpZXdSZWZzLmdldCh0ZW1wbGF0ZVJlZikudmlld1JlZi5kZXN0cm95KCk7XG4gICAgcmV0dXJuIHRoaXMudmlld1JlZnMuZGVsZXRlKHRlbXBsYXRlRGVmKTtcbiAgfVxuXG4gIHJlYXR0YWNoKHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjxhbnk+KTogdm9pZCB7XG4gICAgY29uc3QgdGVtcGxhdGVEZWYgPSB0aGlzLmdldFRlbXBsYXRlRGVmKHRlbXBsYXRlUmVmKTtcbiAgICBjb25zdCB2aWV3UmVmQXR0YWNoYWJsZSA9IHRoaXMuZ2V0KHRlbXBsYXRlUmVmKTtcbiAgICB0aGlzLnZpZXdSZWZzLnNldCh0ZW1wbGF0ZURlZiwgdmlld1JlZkF0dGFjaGFibGUpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy52aWV3UmVmcy5mb3JFYWNoKCh2aWV3UmVmQXR0YWNoYWJsZSkgPT5cbiAgICAgIHZpZXdSZWZBdHRhY2hhYmxlLnZpZXdSZWYuZGVzdHJveSgpKTtcbiAgICB0aGlzLnZpZXdSZWZzLmNsZWFyKCk7XG4gIH1cblxuICBjb2xsZWN0KCk6IHZvaWQge1xuICAgIHRoaXMuZ2MuY29sbGVjdCh0aGlzLnZpZXdSZWZzKTtcbiAgfVxuXG4gIGZvckVhY2goZm46ICh2OiBWaWV3UmVmQXR0YWNoYWJsZSkgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRoaXMudmlld1JlZnMuZm9yRWFjaChmbik7XG4gIH1cblxuICBwcml2YXRlIGdldFRlbXBsYXRlRGVmKHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjxhbnk+KTogVGVtcGxhdGVEZWYge1xuICAgIHJldHVybiB0ZW1wbGF0ZVJlZlsnX2RlZiddO1xuICB9XG59XG5cbkBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pXG5leHBvcnQgY2xhc3MgS2VlcEFsaXZlTWFuYWdlciB7XG4gIHN0YXRpYyBwYXRjaGVkID0gU3ltYm9sKCdBbHJlYWR5IFBhdGNoZWQgVmlld0NvbnRhaW5lclJlZiBUb2tlbicpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdmlld1JlZnM6IEtlZXBBbGl2ZVZpZXdSZWZzKSB7fVxuXG4gIGF0dGFjaCh2aWV3Q29udGFpbmVyUmVmOiBWaWV3Q29udGFpbmVyUmVmLCB0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55Pik6IHZvaWQge1xuICAgIGlmICghdGhpcy52aWV3UmVmcy5oYXModGVtcGxhdGVSZWYpKSB7XG4gICAgICBjb25zdCB2aWV3UmVmID0gdGVtcGxhdGVSZWYuY3JlYXRlRW1iZWRkZWRWaWV3KHt9KTtcbiAgICAgIHRoaXMudmlld1JlZnMuYWRkKHRlbXBsYXRlUmVmLCB2aWV3UmVmKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy52aWV3UmVmcy5yZWF0dGFjaCh0ZW1wbGF0ZVJlZik7XG4gICAgfVxuXG4gICAgdGhpcy5wYXRjaENsZWFyKHZpZXdDb250YWluZXJSZWYpO1xuXG4gICAgY29uc3Qgdmlld1JlZkF0dGFjaGFibGUgPSB0aGlzLnZpZXdSZWZzLmdldCh0ZW1wbGF0ZVJlZik7XG4gICAgdmlld1JlZkF0dGFjaGFibGUuYXR0YWNoVG9WaWV3Q29udGFpbmVyUmVmKHZpZXdDb250YWluZXJSZWYpO1xuXG4gICAgdGhpcy52aWV3UmVmcy5jb2xsZWN0KCk7XG4gIH1cblxuICBkZXRhY2godmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZiwgdGVtcGxhdGVSZWY6IFRlbXBsYXRlUmVmPGFueT4pOiB2b2lkIHtcbiAgICBjb25zdCB2aWV3UmVmQXR0YWNoYWJsZSA9IHRoaXMudmlld1JlZnMuZ2V0KHRlbXBsYXRlUmVmKTtcbiAgICB2aWV3UmVmQXR0YWNoYWJsZS5kZXRhY2hGcm9tVmlld0NvbnRhaW5lclJlZigpO1xuXG4gICAgdGhpcy52aWV3UmVmcy5jb2xsZWN0KCk7XG4gIH1cblxuICBwcml2YXRlIHBhdGNoQ2xlYXIodmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZik6IHZvaWQge1xuICAgIGlmICghdmlld0NvbnRhaW5lclJlZltLZWVwQWxpdmVNYW5hZ2VyLnBhdGNoZWRdKSB7XG4gICAgICBjb25zdCBjbGVhciA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih2aWV3Q29udGFpbmVyUmVmKS5jbGVhcjtcbiAgICAgIGNvbnN0IHZpZXdSZWZzID0gdGhpcy52aWV3UmVmcztcbiAgICAgIE9iamVjdC5nZXRQcm90b3R5cGVPZih2aWV3Q29udGFpbmVyUmVmKS5jbGVhciA9IGZ1bmN0aW9uICh0aGlzOiBWaWV3Q29udGFpbmVyUmVmKSB7XG4gICAgICAgIHZpZXdSZWZzLmZvckVhY2godiA9PiB7IHYudmlld1JlZlsgJ192aWV3JyBdLnN0YXRlIHw9ICgxIDw8IDcpOyB9KTtcbiAgICAgICAgY2xlYXIuY2FsbCh0aGlzKTtcbiAgICAgICAgdmlld1JlZnMuZm9yRWFjaCh2ID0+IHsgdi52aWV3UmVmWyAnX3ZpZXcnIF0uc3RhdGUgJj0gfigxIDw8IDcpOyB9KTtcbiAgICAgIH07XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodmlld0NvbnRhaW5lclJlZiwgS2VlcEFsaXZlTWFuYWdlci5wYXRjaGVkLCB7IGdldDogKCkgPT4gdHJ1ZSB9KTtcbiAgICB9XG4gIH1cblxufVxuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdba2VlcEFsaXZlXSdcbn0pXG5leHBvcnQgY2xhc3MgS2VlcEFsaXZlRGlyZWN0aXZlIGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBtYW5hZ2VyOiBLZWVwQWxpdmVNYW5hZ2VyLFxuICAgIHByaXZhdGUgdmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZixcbiAgICBwcml2YXRlIHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjxhbnk+XG4gICkge1xuICAgIG1hbmFnZXIuYXR0YWNoKHZpZXdDb250YWluZXJSZWYsIHRlbXBsYXRlUmVmKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMubWFuYWdlci5kZXRhY2godGhpcy52aWV3Q29udGFpbmVyUmVmLCB0aGlzLnRlbXBsYXRlUmVmKTtcbiAgfVxufVxuIl19