/**
 * @fileoverview added by tsickle
 * Generated from: lib/tools/cookies.tools.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { __assign, __extends } from "tslib";
import { Inject, Injectable, Optional } from '@angular/core';
import { APP_BASE_HREF } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
/**
 * @record
 */
export function CookieOptionsArgs() { }
if (false) {
    /** @type {?|undefined} */
    CookieOptionsArgs.prototype.path;
    /** @type {?|undefined} */
    CookieOptionsArgs.prototype.domain;
    /** @type {?|undefined} */
    CookieOptionsArgs.prototype.expires;
    /** @type {?|undefined} */
    CookieOptionsArgs.prototype.secure;
}
/**
 * @record
 */
export function ICookies() { }
/**
 * @record
 */
export function ICookieService() { }
if (false) {
    /**
     * @param {?} key
     * @return {?}
     */
    ICookieService.prototype.get = function (key) { };
    /**
     * @param {?} key
     * @param {?} value
     * @param {?=} options
     * @return {?}
     */
    ICookieService.prototype.set = function (key, value, options) { };
    /**
     * @param {?} key
     * @param {?=} options
     * @return {?}
     */
    ICookieService.prototype.remove = function (key, options) { };
}
var CookieOptions = /** @class */ (function () {
    function CookieOptions(_a) {
        var _b = _a === void 0 ? {} : _a, path = _b.path, domain = _b.domain, expires = _b.expires, secure = _b.secure;
        this.path = this.isPresent(path) ? path : null;
        this.domain = this.isPresent(domain) ? domain : null;
        this.expires = this.isPresent(expires) ? expires : null;
        this.secure = this.isPresent(secure) ? secure : false;
    }
    /**
     * @param {?=} options
     * @return {?}
     */
    CookieOptions.prototype.merge = /**
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        return new CookieOptions((/** @type {?} */ ({
            path: this.isPresent(options) && this.isPresent(options.path) ? options.path : this.path,
            domain: this.isPresent(options) && this.isPresent(options.domain) ? options.domain : this.domain,
            expires: this.isPresent(options) && this.isPresent(options.expires) ? options.expires : this.expires,
            secure: this.isPresent(options) && this.isPresent(options.secure) ? options.secure : this.secure,
        })));
    };
    /**
     * @private
     * @param {?} obj
     * @return {?}
     */
    CookieOptions.prototype.isPresent = /**
     * @private
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        return obj !== undefined && obj !== null;
    };
    return CookieOptions;
}());
export { CookieOptions };
if (false) {
    /** @type {?} */
    CookieOptions.prototype.path;
    /** @type {?} */
    CookieOptions.prototype.domain;
    /** @type {?} */
    CookieOptions.prototype.expires;
    /** @type {?} */
    CookieOptions.prototype.secure;
}
var BaseCookieOptions = /** @class */ (function (_super) {
    __extends(BaseCookieOptions, _super);
    function BaseCookieOptions(baseHref) {
        var _this = _super.call(this, { path: baseHref || '/' }) || this;
        _this.baseHref = baseHref;
        return _this;
    }
    BaseCookieOptions.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    BaseCookieOptions.ctorParameters = function () { return [
        { type: String, decorators: [{ type: Optional }, { type: Inject, args: [APP_BASE_HREF,] }] }
    ]; };
    /** @nocollapse */ BaseCookieOptions.ɵprov = i0.ɵɵdefineInjectable({ factory: function BaseCookieOptions_Factory() { return new BaseCookieOptions(i0.ɵɵinject(i1.APP_BASE_HREF, 8)); }, token: BaseCookieOptions, providedIn: "root" });
    return BaseCookieOptions;
}(CookieOptions));
export { BaseCookieOptions };
if (false) {
    /**
     * @type {?}
     * @private
     */
    BaseCookieOptions.prototype.baseHref;
}
var CookiesService = /** @class */ (function () {
    function CookiesService(defaultOptions) {
        this.defaultOptions = defaultOptions;
    }
    Object.defineProperty(CookiesService.prototype, "cookieString", {
        get: /**
         * @protected
         * @return {?}
         */
        function () {
            return document.cookie || '';
        },
        set: /**
         * @protected
         * @param {?} val
         * @return {?}
         */
        function (val) {
            document.cookie = val;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @private
     * @param {?} key
     * @return {?}
     */
    CookiesService.prototype.cookieReader = /**
     * @private
     * @param {?} key
     * @return {?}
     */
    function (key) {
        /** @type {?} */
        var currentCookieString = this.cookieString;
        if (currentCookieString) {
            /** @type {?} */
            var cookieArray = currentCookieString.split('; ');
            return cookieArray.reduce((/**
             * @param {?} cookies
             * @param {?} current
             * @return {?}
             */
            function (cookies, current) {
                var _a;
                /** @type {?} */
                var cookie = current.split('=');
                return __assign(__assign({}, cookies), (_a = {}, _a[cookie[0]] = decodeURIComponent(cookie[1]), _a));
            }), {})[key];
        }
    };
    /**
     * @private
     * @param {?} name
     * @param {?} value
     * @param {?=} options
     * @return {?}
     */
    CookiesService.prototype.cookieWriter = /**
     * @private
     * @param {?} name
     * @param {?} value
     * @param {?=} options
     * @return {?}
     */
    function (name, value, options) {
        this.cookieString = this.buildCookieString(name, value, options);
    };
    /**
     * @private
     * @param {?} name
     * @param {?} value
     * @param {?=} options
     * @return {?}
     */
    CookiesService.prototype.buildCookieString = /**
     * @private
     * @param {?} name
     * @param {?} value
     * @param {?=} options
     * @return {?}
     */
    function (name, value, options) {
        /** @type {?} */
        var defaultOpts = this.defaultOptions || new CookieOptions((/** @type {?} */ ({ path: '/' })));
        /** @type {?} */
        var opts = this.mergeOptions(defaultOpts, options);
        /** @type {?} */
        var expires = opts.expires;
        if (!value) {
            expires = 'Thu, 01 Jan 1970 00:00:00 GMT';
            value = '';
        }
        if (typeof expires === 'string') {
            expires = new Date(expires);
        }
        /** @type {?} */
        var str = encodeURIComponent(name) + '=' + encodeURIComponent(value);
        str += opts.path ? ";path=" + opts.path : '';
        str += opts.domain ? ";domain=" + opts.domain : '';
        str += expires ? ";expires=" + expires.toUTCString() : '';
        str += opts.secure ? ';secure' : '';
        /** @type {?} */
        var cookieLength = str.length + 1;
        if (cookieLength > 4096) {
            console.log("Cookie '" + name + "' possibly not set or overflowed because it was too large (" + cookieLength + " > 4096 bytes)!");
        }
        return str;
    };
    /**
     * @private
     * @param {?} defaultOpts
     * @param {?=} providedOpts
     * @return {?}
     */
    CookiesService.prototype.mergeOptions = /**
     * @private
     * @param {?} defaultOpts
     * @param {?=} providedOpts
     * @return {?}
     */
    function (defaultOpts, providedOpts) {
        /** @type {?} */
        var newOpts = defaultOpts;
        if (providedOpts) {
            return newOpts.merge(new CookieOptions(providedOpts));
        }
        return newOpts;
    };
    /**
     * @param {?} key
     * @return {?}
     */
    CookiesService.prototype.get = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        return this.cookieReader(key);
    };
    /**
     * @param {?} key
     * @param {?} value
     * @param {?=} options
     * @return {?}
     */
    CookiesService.prototype.set = /**
     * @param {?} key
     * @param {?} value
     * @param {?=} options
     * @return {?}
     */
    function (key, value, options) {
        this.cookieWriter(key, value, options);
    };
    /**
     * @param {?} key
     * @param {?=} options
     * @return {?}
     */
    CookiesService.prototype.remove = /**
     * @param {?} key
     * @param {?=} options
     * @return {?}
     */
    function (key, options) {
        this.cookieWriter(key, undefined, options);
    };
    CookiesService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    CookiesService.ctorParameters = function () { return [
        { type: CookieOptions, decorators: [{ type: Optional }] }
    ]; };
    /** @nocollapse */ CookiesService.ɵprov = i0.ɵɵdefineInjectable({ factory: function CookiesService_Factory() { return new CookiesService(i0.ɵɵinject(CookieOptions, 8)); }, token: CookiesService, providedIn: "root" });
    return CookiesService;
}());
export { CookiesService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    CookiesService.prototype.defaultOptions;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29va2llcy50b29scy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BuZ3hmL3BsYXRmb3JtLyIsInNvdXJjZXMiOlsibGliL3Rvb2xzL2Nvb2tpZXMudG9vbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7Ozs7O0FBRWhELHVDQUtDOzs7SUFKRyxpQ0FBYzs7SUFDZCxtQ0FBZ0I7O0lBQ2hCLG9DQUF3Qjs7SUFDeEIsbUNBQWlCOzs7OztBQUdyQiw4QkFFQzs7OztBQUVELG9DQUlDOzs7Ozs7SUFIRyxrREFBeUI7Ozs7Ozs7SUFDekIsa0VBQW1FOzs7Ozs7SUFDbkUsOERBQXVEOztBQUczRDtJQU9JLHVCQUFZLEVBQXlEO1lBQXpELDRCQUF5RCxFQUF2RCxjQUFJLEVBQUUsa0JBQU0sRUFBRSxvQkFBTyxFQUFFLGtCQUFNO1FBQ3ZDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDL0MsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNyRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQ3hELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDMUQsQ0FBQzs7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RlksY0FBYzs7Ozs7O0lBR25CLHdDQUFrRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQVBQX0JBU0VfSFJFRiB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIENvb2tpZU9wdGlvbnNBcmdzIHtcclxuICAgIHBhdGg/OiBzdHJpbmc7XHJcbiAgICBkb21haW4/OiBzdHJpbmc7XHJcbiAgICBleHBpcmVzPzogc3RyaW5nIHwgRGF0ZTtcclxuICAgIHNlY3VyZT86IGJvb2xlYW47XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSUNvb2tpZXMge1xyXG4gICAgW2tleTogc3RyaW5nXTogc3RyaW5nW107XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSUNvb2tpZVNlcnZpY2Uge1xyXG4gICAgZ2V0KGtleTogc3RyaW5nKTogc3RyaW5nO1xyXG4gICAgc2V0KGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBvcHRpb25zPzogQ29va2llT3B0aW9uc0FyZ3MpOiB2b2lkO1xyXG4gICAgcmVtb3ZlKGtleTogc3RyaW5nLCBvcHRpb25zPzogQ29va2llT3B0aW9uc0FyZ3MpOiB2b2lkO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQ29va2llT3B0aW9ucyB7XHJcblxyXG4gICAgcHVibGljIHBhdGg6IHN0cmluZztcclxuICAgIHB1YmxpYyBkb21haW46IHN0cmluZztcclxuICAgIHB1YmxpYyBleHBpcmVzOiBzdHJpbmcgfCBEYXRlO1xyXG4gICAgcHVibGljIHNlY3VyZTogYm9vbGVhbjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih7IHBhdGgsIGRvbWFpbiwgZXhwaXJlcywgc2VjdXJlIH06IENvb2tpZU9wdGlvbnNBcmdzID0ge30pIHtcclxuICAgICAgICB0aGlzLnBhdGggPSB0aGlzLmlzUHJlc2VudChwYXRoKSA/IHBhdGggOiBudWxsO1xyXG4gICAgICAgIHRoaXMuZG9tYWluID0gdGhpcy5pc1ByZXNlbnQoZG9tYWluKSA/IGRvbWFpbiA6IG51bGw7XHJcbiAgICAgICAgdGhpcy5leHBpcmVzID0gdGhpcy5pc1ByZXNlbnQoZXhwaXJlcykgPyBleHBpcmVzIDogbnVsbDtcclxuICAgICAgICB0aGlzLnNlY3VyZSA9IHRoaXMuaXNQcmVzZW50KHNlY3VyZSkgPyBzZWN1cmUgOiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbWVyZ2Uob3B0aW9ucz86IENvb2tpZU9wdGlvbnNBcmdzKTogQ29va2llT3B0aW9ucyB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDb29raWVPcHRpb25zKDxDb29raWVPcHRpb25zQXJncz57XHJcbiAgICAgICAgICAgIHBhdGg6IHRoaXMuaXNQcmVzZW50KG9wdGlvbnMpICYmIHRoaXMuaXNQcmVzZW50KG9wdGlvbnMucGF0aCkgPyBvcHRpb25zLnBhdGggOiB0aGlzLnBhdGgsXHJcbiAgICAgICAgICAgIGRvbWFpbjogdGhpcy5pc1ByZXNlbnQob3B0aW9ucykgJiYgdGhpcy5pc1ByZXNlbnQob3B0aW9ucy5kb21haW4pID8gb3B0aW9ucy5kb21haW4gOiB0aGlzLmRvbWFpbixcclxuICAgICAgICAgICAgZXhwaXJlczogdGhpcy5pc1ByZXNlbnQob3B0aW9ucykgJiYgdGhpcy5pc1ByZXNlbnQob3B0aW9ucy5leHBpcmVzKSA/IG9wdGlvbnMuZXhwaXJlcyA6IHRoaXMuZXhwaXJlcyxcclxuICAgICAgICAgICAgc2VjdXJlOiB0aGlzLmlzUHJlc2VudChvcHRpb25zKSAmJiB0aGlzLmlzUHJlc2VudChvcHRpb25zLnNlY3VyZSkgPyBvcHRpb25zLnNlY3VyZSA6IHRoaXMuc2VjdXJlLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaXNQcmVzZW50KG9iajogYW55KTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIG9iaiAhPT0gdW5kZWZpbmVkICYmIG9iaiAhPT0gbnVsbDtcclxuICAgIH1cclxufVxyXG5cclxuQEluamVjdGFibGUoe1xyXG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBCYXNlQ29va2llT3B0aW9ucyBleHRlbmRzIENvb2tpZU9wdGlvbnMge1xyXG4gICAgY29uc3RydWN0b3IoQE9wdGlvbmFsKCkgQEluamVjdChBUFBfQkFTRV9IUkVGKSBwcml2YXRlIGJhc2VIcmVmOiBzdHJpbmcpIHtcclxuICAgICAgICBzdXBlcih7IHBhdGg6IGJhc2VIcmVmIHx8ICcvJyB9KTtcclxuICAgIH1cclxufVxyXG5cclxuQEluamVjdGFibGUoe1xyXG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb29raWVzU2VydmljZSBpbXBsZW1lbnRzIElDb29raWVTZXJ2aWNlIHtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGRlZmF1bHRPcHRpb25zPzogQ29va2llT3B0aW9uc1xyXG4gICAgKSB7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldCBjb29raWVTdHJpbmcoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gZG9jdW1lbnQuY29va2llIHx8ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBzZXQgY29va2llU3RyaW5nKHZhbDogc3RyaW5nKSB7XHJcbiAgICAgICAgZG9jdW1lbnQuY29va2llID0gdmFsO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY29va2llUmVhZGVyKGtleTogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICBjb25zdCBjdXJyZW50Q29va2llU3RyaW5nID0gdGhpcy5jb29raWVTdHJpbmc7XHJcblxyXG4gICAgICAgIGlmIChjdXJyZW50Q29va2llU3RyaW5nKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvb2tpZUFycmF5ID0gY3VycmVudENvb2tpZVN0cmluZy5zcGxpdCgnOyAnKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb29raWVBcnJheS5yZWR1Y2UoKGNvb2tpZXM6IElDb29raWVzLCBjdXJyZW50OiBzdHJpbmcpOiBvYmplY3QgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY29va2llID0gY3VycmVudC5zcGxpdCgnPScpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB7IC4uLmNvb2tpZXMsIFtjb29raWVbMF1dOiBkZWNvZGVVUklDb21wb25lbnQoY29va2llWzFdKSB9O1xyXG4gICAgICAgICAgICB9LCB7fSlba2V5XTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjb29raWVXcml0ZXIobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBvcHRpb25zPzogQ29va2llT3B0aW9uc0FyZ3MpIHtcclxuICAgICAgICB0aGlzLmNvb2tpZVN0cmluZyA9IHRoaXMuYnVpbGRDb29raWVTdHJpbmcobmFtZSwgdmFsdWUsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRDb29raWVTdHJpbmcobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBvcHRpb25zPzogQ29va2llT3B0aW9uc0FyZ3MpOiBzdHJpbmcge1xyXG4gICAgICAgIGNvbnN0IGRlZmF1bHRPcHRzID0gdGhpcy5kZWZhdWx0T3B0aW9ucyB8fCBuZXcgQ29va2llT3B0aW9ucyg8Q29va2llT3B0aW9uc0FyZ3M+eyBwYXRoOiAnLycgfSk7XHJcbiAgICAgICAgY29uc3Qgb3B0czogQ29va2llT3B0aW9ucyA9IHRoaXMubWVyZ2VPcHRpb25zKGRlZmF1bHRPcHRzLCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgbGV0IGV4cGlyZXMgPSBvcHRzLmV4cGlyZXM7XHJcblxyXG4gICAgICAgIGlmICghdmFsdWUpIHtcclxuICAgICAgICAgICAgZXhwaXJlcyA9ICdUaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIEdNVCc7XHJcbiAgICAgICAgICAgIHZhbHVlID0gJyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHlwZW9mIGV4cGlyZXMgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIGV4cGlyZXMgPSBuZXcgRGF0ZShleHBpcmVzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBzdHIgPSBlbmNvZGVVUklDb21wb25lbnQobmFtZSkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpO1xyXG5cclxuICAgICAgICBzdHIgKz0gb3B0cy5wYXRoID8gYDtwYXRoPSR7b3B0cy5wYXRofWAgOiAnJztcclxuICAgICAgICBzdHIgKz0gb3B0cy5kb21haW4gPyBgO2RvbWFpbj0ke29wdHMuZG9tYWlufWAgOiAnJztcclxuICAgICAgICBzdHIgKz0gZXhwaXJlcyA/IGA7ZXhwaXJlcz0ke2V4cGlyZXMudG9VVENTdHJpbmcoKX1gIDogJyc7XHJcbiAgICAgICAgc3RyICs9IG9wdHMuc2VjdXJlID8gJztzZWN1cmUnIDogJyc7XHJcblxyXG4gICAgICAgIGNvbnN0IGNvb2tpZUxlbmd0aCA9IHN0ci5sZW5ndGggKyAxO1xyXG5cclxuICAgICAgICBpZiAoY29va2llTGVuZ3RoID4gNDA5Nikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgQ29va2llIFxcJyR7bmFtZX1cXCcgcG9zc2libHkgbm90IHNldCBvciBvdmVyZmxvd2VkIGJlY2F1c2UgaXQgd2FzIHRvbyBsYXJnZSAoJHtjb29raWVMZW5ndGh9ID4gNDA5NiBieXRlcykhYCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc3RyO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbWVyZ2VPcHRpb25zKGRlZmF1bHRPcHRzOiBDb29raWVPcHRpb25zLCBwcm92aWRlZE9wdHM/OiBDb29raWVPcHRpb25zQXJncyk6IENvb2tpZU9wdGlvbnMge1xyXG4gICAgICAgIGNvbnN0IG5ld09wdHMgPSBkZWZhdWx0T3B0cztcclxuXHJcbiAgICAgICAgaWYgKHByb3ZpZGVkT3B0cykge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3T3B0cy5tZXJnZShuZXcgQ29va2llT3B0aW9ucyhwcm92aWRlZE9wdHMpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBuZXdPcHRzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXQoa2V5OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvb2tpZVJlYWRlcihrZXkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcsIG9wdGlvbnM/OiBDb29raWVPcHRpb25zQXJncyk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY29va2llV3JpdGVyKGtleSwgdmFsdWUsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyByZW1vdmUoa2V5OiBzdHJpbmcsIG9wdGlvbnM/OiBDb29raWVPcHRpb25zQXJncyk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY29va2llV3JpdGVyKGtleSwgdW5kZWZpbmVkLCBvcHRpb25zKTtcclxuICAgIH1cclxufVxyXG4iXX0=